{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "lucky-transcription",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:13.898356Z",
     "start_time": "2021-02-20T17:22:12.455275Z"
    }
   },
   "outputs": [],
   "source": [
    "import larch\n",
    "import numpy as np"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "superior-hands",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:13.903861Z",
     "start_time": "2021-02-20T17:22:13.900555Z"
    }
   },
   "outputs": [],
   "source": [
    "np.set_printoptions(\n",
    "    edgeitems=10, \n",
    "    linewidth=200, \n",
    "    formatter=dict(float=lambda x: \"{:<9.4g}\".format(x))\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "successful-paper",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:13.912302Z",
     "start_time": "2021-02-20T17:22:13.906819Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "larch.model.model.Model"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "larch.Model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "present-attack",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:14.059627Z",
     "start_time": "2021-02-20T17:22:13.914389Z"
    }
   },
   "outputs": [],
   "source": [
    "m = larch.example(22)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "inappropriate-irrigation",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:14.294587Z",
     "start_time": "2021-02-20T17:22:14.061064Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div xmlns=\"http://www.w3.org/2000/svg\"><svg width=\"624pt\" height=\"204pt\" viewBox=\"0.00 0.00 624.00 204.00\">\n",
       "<g id=\"graph0\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 200)\">\n",
       "<title>%3</title>\n",
       "<polygon fill=\"white\" stroke=\"transparent\" points=\"-4,4 -4,-200 620,-200 620,4 -4,4\"></polygon>\n",
       "<g id=\"clust1\" class=\"cluster\">\n",
       "<title>cluster_elemental</title>\n",
       "<path fill=\"lightgrey\" stroke=\"white\" d=\"M20,-8C20,-8 596,-8 596,-8 602,-8 608,-14 608,-20 608,-20 608,-48 608,-48 608,-54 602,-60 596,-60 596,-60 20,-60 20,-60 14,-60 8,-54 8,-48 8,-48 8,-20 8,-20 8,-14 14,-8 20,-8\"></path>\n",
       "</g>\n",
       "\n",
       "<g id=\"node1\" class=\"node\">\n",
       "<title>0</title>\n",
       "<polygon fill=\"none\" stroke=\"black\" points=\"337,-172.44 364,-160 391,-172.44 390.97,-192.56 337.03,-192.56 337,-172.44\"></polygon>\n",
       "<text text-anchor=\"middle\" x=\"364\" y=\"-174.3\" font-family=\"Times,serif\" font-size=\"14.00\">0</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node8\" class=\"node\">\n",
       "<title>7</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M305,-124C305,-124 241,-124 241,-124 235,-124 229,-118 229,-112 229,-112 229,-100 229,-100 229,-94 235,-88 241,-88 241,-88 305,-88 305,-88 311,-88 317,-94 317,-100 317,-100 317,-112 317,-112 317,-118 311,-124 305,-124\"></path>\n",
       "<text text-anchor=\"start\" x=\"237\" y=\"-107.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(7) </text>\n",
       "<text text-anchor=\"start\" x=\"250\" y=\"-107.3\" font-family=\"Times,serif\" font-size=\"14.00\">Motorized</text>\n",
       "<text text-anchor=\"start\" x=\"254\" y=\"-97.3\" font-family=\"Times,serif\" font-style=\"italic\" font-size=\"9.00\" fill=\"#999999\">mu_motor</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge1\" class=\"edge\">\n",
       "<title>0-&gt;7</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M349.78,-166.06C337.47,-156.59 319.22,-142.56 303.61,-130.55\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"305.32,-127.45 295.26,-124.12 301.05,-133 305.32,-127.45\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"node9\" class=\"node\">\n",
       "<title>8</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M499,-124C499,-124 413,-124 413,-124 407,-124 401,-118 401,-112 401,-112 401,-100 401,-100 401,-94 407,-88 413,-88 413,-88 499,-88 499,-88 505,-88 511,-94 511,-100 511,-100 511,-112 511,-112 511,-118 505,-124 499,-124\"></path>\n",
       "<text text-anchor=\"start\" x=\"409\" y=\"-107.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(8) </text>\n",
       "<text text-anchor=\"start\" x=\"422\" y=\"-107.3\" font-family=\"Times,serif\" font-size=\"14.00\">Nonmotorized</text>\n",
       "<text text-anchor=\"start\" x=\"430.5\" y=\"-97.3\" font-family=\"Times,serif\" font-style=\"italic\" font-size=\"9.00\" fill=\"#999999\">mu_nonmotor</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge2\" class=\"edge\">\n",
       "<title>0-&gt;8</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M377.97,-166.37C390.56,-156.79 409.49,-142.39 425.56,-130.16\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"427.81,-132.85 433.65,-124.01 423.57,-127.28 427.81,-132.85\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"node2\" class=\"node\">\n",
       "<title>1</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"359\" cy=\"-34\" rx=\"32.49\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"342\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(1) </text>\n",
       "<text text-anchor=\"start\" x=\"355\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">DA</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node3\" class=\"node\">\n",
       "<title>2</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"273\" cy=\"-34\" rx=\"35.19\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"254\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(2) </text>\n",
       "<text text-anchor=\"start\" x=\"267\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">SR2</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node4\" class=\"node\">\n",
       "<title>3</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"185\" cy=\"-34\" rx=\"35.19\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"166\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(3) </text>\n",
       "<text text-anchor=\"start\" x=\"179\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">SR3</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node5\" class=\"node\">\n",
       "<title>4</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"74\" cy=\"-34\" rx=\"57.69\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"37.5\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(4) </text>\n",
       "<text text-anchor=\"start\" x=\"50.5\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">TRANSIT</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node6\" class=\"node\">\n",
       "<title>5</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"560\" cy=\"-34\" rx=\"40.09\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"537\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(5) </text>\n",
       "<text text-anchor=\"start\" x=\"550\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">BIKE</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node7\" class=\"node\">\n",
       "<title>6</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"456\" cy=\"-34\" rx=\"46.29\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"428.5\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(6) </text>\n",
       "<text text-anchor=\"start\" x=\"441.5\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">WALK</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge3\" class=\"edge\">\n",
       "<title>7-&gt;1</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M294.26,-87.7C306.17,-78 321.11,-65.84 333.63,-55.65\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"335.91,-58.31 341.46,-49.28 331.49,-52.88 335.91,-58.31\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge4\" class=\"edge\">\n",
       "<title>7-&gt;2</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M273,-87.7C273,-79.98 273,-70.71 273,-62.11\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"276.5,-62.1 273,-52.1 269.5,-62.1 276.5,-62.1\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge5\" class=\"edge\">\n",
       "<title>7-&gt;3</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M251.25,-87.7C239.14,-78.07 223.98,-66.01 211.22,-55.86\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"213.24,-52.99 203.24,-49.51 208.89,-58.47 213.24,-52.99\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge6\" class=\"edge\">\n",
       "<title>7-&gt;4</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M228.89,-90.31C203.19,-81.67 170.19,-70.42 141,-60 133.93,-57.47 126.45,-54.75 119.17,-52.05\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"119.99,-48.63 109.4,-48.42 117.55,-55.19 119.99,-48.63\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge7\" class=\"edge\">\n",
       "<title>8-&gt;5</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M481.44,-87.88C496.12,-78 514.66,-65.52 530.04,-55.17\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"532.34,-57.84 538.68,-49.35 528.43,-52.03 532.34,-57.84\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge8\" class=\"edge\">\n",
       "<title>8-&gt;6</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M456,-87.7C456,-79.98 456,-70.71 456,-62.11\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"459.5,-62.1 456,-52.1 452.5,-62.1 459.5,-62.1\"></polygon>\n",
       "</g>\n",
       "</g>\n",
       "</svg></div>"
      ],
      "text/plain": [
       "<larch.model.tree.NestingTree at 0x7fe6b84c0640>"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "m.graph"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "motivated-williams",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:24.901891Z",
     "start_time": "2021-02-20T17:22:14.296516Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<h3>Iteration 048 [Optimization terminated successfully] </h3>"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<p>LL = -3441.6725272475805</p>"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>value</th>\n",
       "      <th>initvalue</th>\n",
       "      <th>nullvalue</th>\n",
       "      <th>minimum</th>\n",
       "      <th>maximum</th>\n",
       "      <th>holdfast</th>\n",
       "      <th>note</th>\n",
       "      <th>best</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>ASC_BIKE</th>\n",
       "      <td>-1.201235</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-1.201235</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_SR2</th>\n",
       "      <td>-1.325025</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-1.325025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_SR3</th>\n",
       "      <td>-2.505543</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-2.505543</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_TRANSIT</th>\n",
       "      <td>-0.403523</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.403523</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_WALK</th>\n",
       "      <td>0.345445</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.345445</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>costbyincome</th>\n",
       "      <td>-0.038615</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.038615</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>hhinc#4</th>\n",
       "      <td>-0.003931</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.003931</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>hhinc#5</th>\n",
       "      <td>-0.010045</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.010045</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>hhinc#6</th>\n",
       "      <td>-0.006207</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.006207</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>motorized_ovtbydist</th>\n",
       "      <td>-0.113798</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.113798</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>motorized_time</th>\n",
       "      <td>-0.014523</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.014523</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mu_motor</th>\n",
       "      <td>0.725787</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.001</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.725787</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mu_nonmotor</th>\n",
       "      <td>0.768938</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.001</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.768938</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>nonmotorized_time</th>\n",
       "      <td>-0.046215</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.046215</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_BIKE</th>\n",
       "      <td>-0.734800</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.734800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_SR</th>\n",
       "      <td>-0.225671</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.225671</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_TRANSIT</th>\n",
       "      <td>-0.707055</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.707055</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_WALK</th>\n",
       "      <td>-0.763868</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>-0.763868</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_BIKE</th>\n",
       "      <td>0.407703</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.407703</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_SR2</th>\n",
       "      <td>0.193141</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.193141</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_SR3</th>\n",
       "      <td>0.780955</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.780955</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_TRANSIT</th>\n",
       "      <td>0.921274</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.921274</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_WALK</th>\n",
       "      <td>0.114114</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.114114</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_BIKE</th>\n",
       "      <td>0.001674</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.001674</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_SR2</th>\n",
       "      <td>0.001149</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.001149</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_SR3</th>\n",
       "      <td>0.001638</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.001638</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_TRANSIT</th>\n",
       "      <td>0.002237</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.002237</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_WALK</th>\n",
       "      <td>0.002170</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-inf</td>\n",
       "      <td>inf</td>\n",
       "      <td>0</td>\n",
       "      <td></td>\n",
       "      <td>0.002170</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                        value  initvalue  nullvalue  minimum  maximum  \\\n",
       "ASC_BIKE            -1.201235        0.0        0.0     -inf      inf   \n",
       "ASC_SR2             -1.325025        0.0        0.0     -inf      inf   \n",
       "ASC_SR3             -2.505543        0.0        0.0     -inf      inf   \n",
       "ASC_TRANSIT         -0.403523        0.0        0.0     -inf      inf   \n",
       "ASC_WALK             0.345445        0.0        0.0     -inf      inf   \n",
       "costbyincome        -0.038615        0.0        0.0     -inf      inf   \n",
       "hhinc#4             -0.003931        0.0        0.0     -inf      inf   \n",
       "hhinc#5             -0.010045        0.0        0.0     -inf      inf   \n",
       "hhinc#6             -0.006207        0.0        0.0     -inf      inf   \n",
       "motorized_ovtbydist -0.113798        0.0        0.0     -inf      inf   \n",
       "motorized_time      -0.014523        0.0        0.0     -inf      inf   \n",
       "mu_motor             0.725787        1.0        1.0    0.001      1.0   \n",
       "mu_nonmotor          0.768938        1.0        1.0    0.001      1.0   \n",
       "nonmotorized_time   -0.046215        0.0        0.0     -inf      inf   \n",
       "vehbywrk_BIKE       -0.734800        0.0        0.0     -inf      inf   \n",
       "vehbywrk_SR         -0.225671        0.0        0.0     -inf      inf   \n",
       "vehbywrk_TRANSIT    -0.707055        0.0        0.0     -inf      inf   \n",
       "vehbywrk_WALK       -0.763868        0.0        0.0     -inf      inf   \n",
       "wkcbd_BIKE           0.407703        0.0        0.0     -inf      inf   \n",
       "wkcbd_SR2            0.193141        0.0        0.0     -inf      inf   \n",
       "wkcbd_SR3            0.780955        0.0        0.0     -inf      inf   \n",
       "wkcbd_TRANSIT        0.921274        0.0        0.0     -inf      inf   \n",
       "wkcbd_WALK           0.114114        0.0        0.0     -inf      inf   \n",
       "wkempden_BIKE        0.001674        0.0        0.0     -inf      inf   \n",
       "wkempden_SR2         0.001149        0.0        0.0     -inf      inf   \n",
       "wkempden_SR3         0.001638        0.0        0.0     -inf      inf   \n",
       "wkempden_TRANSIT     0.002237        0.0        0.0     -inf      inf   \n",
       "wkempden_WALK        0.002170        0.0        0.0     -inf      inf   \n",
       "\n",
       "                     holdfast note      best  \n",
       "ASC_BIKE                    0      -1.201235  \n",
       "ASC_SR2                     0      -1.325025  \n",
       "ASC_SR3                     0      -2.505543  \n",
       "ASC_TRANSIT                 0      -0.403523  \n",
       "ASC_WALK                    0       0.345445  \n",
       "costbyincome                0      -0.038615  \n",
       "hhinc#4                     0      -0.003931  \n",
       "hhinc#5                     0      -0.010045  \n",
       "hhinc#6                     0      -0.006207  \n",
       "motorized_ovtbydist         0      -0.113798  \n",
       "motorized_time              0      -0.014523  \n",
       "mu_motor                    0       0.725787  \n",
       "mu_nonmotor                 0       0.768938  \n",
       "nonmotorized_time           0      -0.046215  \n",
       "vehbywrk_BIKE               0      -0.734800  \n",
       "vehbywrk_SR                 0      -0.225671  \n",
       "vehbywrk_TRANSIT            0      -0.707055  \n",
       "vehbywrk_WALK               0      -0.763868  \n",
       "wkcbd_BIKE                  0       0.407703  \n",
       "wkcbd_SR2                   0       0.193141  \n",
       "wkcbd_SR3                   0       0.780955  \n",
       "wkcbd_TRANSIT               0       0.921274  \n",
       "wkcbd_WALK                  0       0.114114  \n",
       "wkempden_BIKE               0       0.001674  \n",
       "wkempden_SR2                0       0.001149  \n",
       "wkempden_SR3                0       0.001638  \n",
       "wkempden_TRANSIT            0       0.002237  \n",
       "wkempden_WALK               0       0.002170  "
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/Users/jeffnewman/opt/anaconda3/envs/garage38/lib/python3.8/site-packages/numpy/core/_methods.py:47: RuntimeWarning: invalid value encountered in reduce\n",
      "  return umr_sum(a, axis, dtype, out, keepdims, initial, where)\n",
      "/Users/jeffnewman/opt/anaconda3/envs/garage38/lib/python3.8/site-packages/numpy/core/_methods.py:47: RuntimeWarning: invalid value encountered in reduce\n",
      "  return umr_sum(a, axis, dtype, out, keepdims, initial, where)\n",
      "/Users/jeffnewman/opt/anaconda3/envs/garage38/lib/python3.8/site-packages/numpy/core/_methods.py:47: RuntimeWarning: invalid value encountered in reduce\n",
      "  return umr_sum(a, axis, dtype, out, keepdims, initial, where)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div><table style=\"margin-top:1px;\"><tr><th>key</th><th style=\"text-align:left;\">value</th></tr><tr><td>x</td><td style=\"text-align:left;\"><table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>ASC_BIKE</th>\n",
       "      <td>-1.201235</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_SR2</th>\n",
       "      <td>-1.325025</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_SR3</th>\n",
       "      <td>-2.505543</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_TRANSIT</th>\n",
       "      <td>-0.403523</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_WALK</th>\n",
       "      <td>0.345445</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>costbyincome</th>\n",
       "      <td>-0.038615</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>hhinc#4</th>\n",
       "      <td>-0.003931</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>hhinc#5</th>\n",
       "      <td>-0.010045</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>hhinc#6</th>\n",
       "      <td>-0.006207</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>motorized_ovtbydist</th>\n",
       "      <td>-0.113798</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>motorized_time</th>\n",
       "      <td>-0.014523</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mu_motor</th>\n",
       "      <td>0.725787</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mu_nonmotor</th>\n",
       "      <td>0.768938</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>nonmotorized_time</th>\n",
       "      <td>-0.046215</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_BIKE</th>\n",
       "      <td>-0.734800</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_SR</th>\n",
       "      <td>-0.225671</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_TRANSIT</th>\n",
       "      <td>-0.707055</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_WALK</th>\n",
       "      <td>-0.763868</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_BIKE</th>\n",
       "      <td>0.407703</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_SR2</th>\n",
       "      <td>0.193141</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_SR3</th>\n",
       "      <td>0.780955</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_TRANSIT</th>\n",
       "      <td>0.921274</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_WALK</th>\n",
       "      <td>0.114114</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_BIKE</th>\n",
       "      <td>0.001674</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_SR2</th>\n",
       "      <td>0.001149</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_SR3</th>\n",
       "      <td>0.001638</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_TRANSIT</th>\n",
       "      <td>0.002237</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_WALK</th>\n",
       "      <td>0.002170</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table></td></tr><tr><td>loglike</td><td style=\"text-align:left;\">-3441.6725272475805</td></tr><tr><td>d_loglike</td><td style=\"text-align:left;\"><table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>ASC_BIKE</th>\n",
       "      <td>0.001096</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_SR2</th>\n",
       "      <td>0.002816</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_SR3</th>\n",
       "      <td>-0.000161</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_TRANSIT</th>\n",
       "      <td>-0.000941</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ASC_WALK</th>\n",
       "      <td>-0.001746</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>costbyincome</th>\n",
       "      <td>-0.018781</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>hhinc#4</th>\n",
       "      <td>0.042637</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>hhinc#5</th>\n",
       "      <td>0.054682</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>hhinc#6</th>\n",
       "      <td>-0.198514</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>motorized_ovtbydist</th>\n",
       "      <td>-0.004421</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>motorized_time</th>\n",
       "      <td>-0.023584</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mu_motor</th>\n",
       "      <td>-0.001409</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mu_nonmotor</th>\n",
       "      <td>0.000154</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>nonmotorized_time</th>\n",
       "      <td>-0.026345</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_BIKE</th>\n",
       "      <td>0.001556</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_SR</th>\n",
       "      <td>0.005059</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_TRANSIT</th>\n",
       "      <td>-0.001194</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>vehbywrk_WALK</th>\n",
       "      <td>-0.003497</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_BIKE</th>\n",
       "      <td>0.000275</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_SR2</th>\n",
       "      <td>0.000126</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_SR3</th>\n",
       "      <td>0.000172</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_TRANSIT</th>\n",
       "      <td>0.001999</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkcbd_WALK</th>\n",
       "      <td>0.000515</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_BIKE</th>\n",
       "      <td>0.097725</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_SR2</th>\n",
       "      <td>0.228821</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_SR3</th>\n",
       "      <td>0.132721</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_TRANSIT</th>\n",
       "      <td>-0.099216</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>wkempden_WALK</th>\n",
       "      <td>0.140379</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table></td></tr><tr><td>nit</td><td style=\"text-align:left;\">48</td></tr><tr><td>nfev</td><td style=\"text-align:left;\">162</td></tr><tr><td>njev</td><td style=\"text-align:left;\">48</td></tr><tr><td>status</td><td style=\"text-align:left;\">0</td></tr><tr><td>message</td><td style=\"text-align:left;\">'Optimization terminated successfully'</td></tr><tr><td>success</td><td style=\"text-align:left;\">True</td></tr><tr><td>elapsed_time</td><td style=\"text-align:left;\">0:00:08.812012</td></tr><tr><td>method</td><td style=\"text-align:left;\">'slsqp'</td></tr><tr><td>n_cases</td><td style=\"text-align:left;\">5029</td></tr><tr><td>iteration_number</td><td style=\"text-align:left;\">48</td></tr><tr><td>logloss</td><td style=\"text-align:left;\">0.6843651873628118</td></tr></table></div>"
      ],
      "text/plain": [
       "┣                x: ASC_BIKE              -1.201235\n",
       "┃                   ASC_SR2               -1.325025\n",
       "┃                   ASC_SR3               -2.505543\n",
       "┃                   ASC_TRANSIT           -0.403523\n",
       "┃                   ASC_WALK               0.345445\n",
       "┃                   costbyincome          -0.038615\n",
       "┃                   hhinc#4               -0.003931\n",
       "┃                   hhinc#5               -0.010045\n",
       "┃                   hhinc#6               -0.006207\n",
       "┃                   motorized_ovtbydist   -0.113798\n",
       "┃                   motorized_time        -0.014523\n",
       "┃                   mu_motor               0.725787\n",
       "┃                   mu_nonmotor            0.768938\n",
       "┃                   nonmotorized_time     -0.046215\n",
       "┃                   vehbywrk_BIKE         -0.734800\n",
       "┃                   vehbywrk_SR           -0.225671\n",
       "┃                   vehbywrk_TRANSIT      -0.707055\n",
       "┃                   vehbywrk_WALK         -0.763868\n",
       "┃                   wkcbd_BIKE             0.407703\n",
       "┃                   wkcbd_SR2              0.193141\n",
       "┃                   wkcbd_SR3              0.780955\n",
       "┃                   wkcbd_TRANSIT          0.921274\n",
       "┃                   wkcbd_WALK             0.114114\n",
       "┃                   wkempden_BIKE          0.001674\n",
       "┃                   wkempden_SR2           0.001149\n",
       "┃                   wkempden_SR3           0.001638\n",
       "┃                   wkempden_TRANSIT       0.002237\n",
       "┃                   wkempden_WALK          0.002170\n",
       "┃                   dtype: float64\n",
       "┣          loglike: -3441.6725272475805\n",
       "┣        d_loglike: ASC_BIKE               0.001096\n",
       "┃                   ASC_SR2                0.002816\n",
       "┃                   ASC_SR3               -0.000161\n",
       "┃                   ASC_TRANSIT           -0.000941\n",
       "┃                   ASC_WALK              -0.001746\n",
       "┃                   costbyincome          -0.018781\n",
       "┃                   hhinc#4                0.042637\n",
       "┃                   hhinc#5                0.054682\n",
       "┃                   hhinc#6               -0.198514\n",
       "┃                   motorized_ovtbydist   -0.004421\n",
       "┃                   motorized_time        -0.023584\n",
       "┃                   mu_motor              -0.001409\n",
       "┃                   mu_nonmotor            0.000154\n",
       "┃                   nonmotorized_time     -0.026345\n",
       "┃                   vehbywrk_BIKE          0.001556\n",
       "┃                   vehbywrk_SR            0.005059\n",
       "┃                   vehbywrk_TRANSIT      -0.001194\n",
       "┃                   vehbywrk_WALK         -0.003497\n",
       "┃                   wkcbd_BIKE             0.000275\n",
       "┃                   wkcbd_SR2              0.000126\n",
       "┃                   wkcbd_SR3              0.000172\n",
       "┃                   wkcbd_TRANSIT          0.001999\n",
       "┃                   wkcbd_WALK             0.000515\n",
       "┃                   wkempden_BIKE          0.097725\n",
       "┃                   wkempden_SR2           0.228821\n",
       "┃                   wkempden_SR3           0.132721\n",
       "┃                   wkempden_TRANSIT      -0.099216\n",
       "┃                   wkempden_WALK          0.140379\n",
       "┃                   dtype: float64\n",
       "┣              nit: 48\n",
       "┣             nfev: 162\n",
       "┣             njev: 48\n",
       "┣           status: 0\n",
       "┣          message: 'Optimization terminated successfully'\n",
       "┣          success: True\n",
       "┣     elapsed_time: datetime.timedelta(seconds=8, microseconds=812012)\n",
       "┣           method: 'slsqp'\n",
       "┣          n_cases: 5029\n",
       "┣ iteration_number: 48\n",
       "┣          logloss: 0.6843651873628118"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "m.estimate()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "killing-decline",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:24.967838Z",
     "start_time": "2021-02-20T17:22:24.903787Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(5029, 6)"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "m.probability().shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "collected-saskatchewan",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.034834Z",
     "start_time": "2021-02-20T17:22:24.972513Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([-0.2752  , 0.5206   , -0.1259  , 0.1256   , -0.5672  , -0.273   , -0.114   , -0.3996  , -0.1453  , -0.1819  , ..., -0.2065  , -0.5604  , -0.9356  , -0.153   , -0.2931  , -0.8378  , -0.3106  ,\n",
       "       -0.3426  , -0.3277  , -0.7013  ])"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "m.logsums()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "increasing-template",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.099862Z",
     "start_time": "2021-02-20T17:22:25.037839Z"
    }
   },
   "outputs": [],
   "source": [
    "u = m.utility().copy()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "artificial-runner",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.105334Z",
     "start_time": "2021-02-20T17:22:25.101835Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(5029, 9)"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "u.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "viral-dealing",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.168055Z",
     "start_time": "2021-02-20T17:22:25.107199Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[0.9445   , 0.04172  , 0.00805  , 0.003812 , 0.001929 , 0        ],\n",
       "       [0.05883  , 0.0498   , 0.06423  , 0.8111   , 0.01606  , 0        ],\n",
       "       [0.6012   , 0.1159   , 0.0517   , 0.2312   , 0        , 0        ],\n",
       "       [0.2344   , 0.07462  , 0.06167  , 0.6293   , 0        , 0        ],\n",
       "       [0        , 0.2567   , 0.1103   , 0.5735   , 0.0595   , 0        ],\n",
       "       [0        , 0.2073   , 0.08987  , 0.5458   , 0.09228  , 0.06476  ],\n",
       "       [0.7321   , 0.1107   , 0.04866  , 0.01129  , 0.07776  , 0.01948  ],\n",
       "       [0.8282   , 0.1044   , 0.02118  , 0.03886  , 0.007348 , 0        ],\n",
       "       [0.8391   , 0.08951  , 0.03872  , 0.03271  , 0        , 0        ],\n",
       "       [0.6637   , 0.1033   , 0.04596  , 0.1871   , 0        , 0        ],\n",
       "       [0.07606  , 0.0445   , 0.04475  , 0.8206   , 0.01407  , 0        ],\n",
       "       [0.9609   , 0.03155  , 0.006124 , 0.001442 , 0        , 0        ],\n",
       "       [0.8142   , 0.09724  , 0.04225  , 0.04636  , 0        , 0        ],\n",
       "       [0.7823   , 0.09343  , 0.04059  , 0.08371  , 0        , 0        ],\n",
       "       [0.8535   , 0.07664  , 0.03291  , 0.03235  , 0.004608 , 0        ],\n",
       "       [0.888    , 0.0933   , 0.01873  , 0        , 0        , 0        ]])"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "m.probability()[:16]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "senior-pollution",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.173795Z",
     "start_time": "2021-02-20T17:22:25.169979Z"
    }
   },
   "outputs": [],
   "source": [
    "p = m.probability_from_utility(u)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "arbitrary-moscow",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.180081Z",
     "start_time": "2021-02-20T17:22:25.175783Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[0.9445   , 0.04172  , 0.00805  , 0.003812 , 0.001929 , 0        , 0.9981   , 0.001929 , 1        ],\n",
       "       [0.05883  , 0.0498   , 0.06423  , 0.8111   , 0.01606  , 0        , 0.9839   , 0.01606  , 1        ],\n",
       "       [0.6012   , 0.1159   , 0.0517   , 0.2312   , 0        , 0        , 1        , 0        , 1        ],\n",
       "       [0.2344   , 0.07462  , 0.06167  , 0.6293   , 0        , 0        , 1        , 0        , 1        ],\n",
       "       [0        , 0.2567   , 0.1103   , 0.5735   , 0.0595   , 0        , 0.9405   , 0.0595   , 1        ],\n",
       "       [0        , 0.2073   , 0.08987  , 0.5458   , 0.09228  , 0.06476  , 0.843    , 0.157    , 1        ],\n",
       "       [0.7321   , 0.1107   , 0.04866  , 0.01129  , 0.07776  , 0.01948  , 0.9028   , 0.09723  , 1        ],\n",
       "       [0.8282   , 0.1044   , 0.02118  , 0.03886  , 0.007348 , 0        , 0.9927   , 0.007348 , 1        ],\n",
       "       [0.8391   , 0.08951  , 0.03872  , 0.03271  , 0        , 0        , 1        , 0        , 1        ],\n",
       "       [0.6637   , 0.1033   , 0.04596  , 0.1871   , 0        , 0        , 1        , 0        , 1        ],\n",
       "       ...,\n",
       "       [0.9168   , 0.05388  , 0.01028  , 0.002787 , 0        , 0.01629  , 0.9837   , 0.01629  , 1        ],\n",
       "       [0.903    , 0.08085  , 0.01618  , 0        , 0        , 0        , 1        , 0        , 1        ],\n",
       "       [0.7638   , 0.1208   , 0.02705  , 0.08833  , 0        , 0        , 1        , 0        , 1        ],\n",
       "       [0.8586   , 0.07015  , 0.0135   , 0.01135  , 0.0203   , 0.02614  , 0.9536   , 0.04644  , 1        ],\n",
       "       [0.8861   , 0.07216  , 0.01386  , 0.02047  , 0        , 0.007443 , 0.9926   , 0.007443 , 1        ],\n",
       "       [0.8932   , 0.08836  , 0.01846  , 0        , 0        , 0        , 1        , 0        , 1        ],\n",
       "       [0.8817   , 0.07847  , 0.01566  , 0.02422  , 0        , 0        , 1        , 0        , 1        ],\n",
       "       [0.9067   , 0.07794  , 0.01533  , 0        , 0        , 0        , 1        , 0        , 1        ],\n",
       "       [0.9164   , 0.05559  , 0.01076  , 0.007767 , 0        , 0.009466 , 0.9905   , 0.009466 , 1        ],\n",
       "       [0.8271   , 0.05091  , 0.009909 , 0.001544 , 0.0174   , 0.0931   , 0.8895   , 0.1105   , 1        ]])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "p"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "numerical-awareness",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.185318Z",
     "start_time": "2021-02-20T17:22:25.181793Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(5029, 9)"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "u.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "cloudy-chain",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T16:31:53.952922Z",
     "start_time": "2021-02-20T16:31:53.948369Z"
    }
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "opening-ministry",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.283406Z",
     "start_time": "2021-02-20T17:22:25.187190Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       ...,\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ],\n",
       "       [0.154    , 0.154    , 0.154    , 0.154    , 0.1919   , 0.1919   , 0.6161   , 0.3839   , 1        ]])"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "m.probability_from_utility(np.zeros([1000000,9]))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "pacific-moderator",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.293737Z",
     "start_time": "2021-02-20T17:22:25.285346Z"
    }
   },
   "outputs": [],
   "source": [
    "m2 = larch.Model(graph=m.graph)#.probability_from_utility(np.zeros([1000000,9]))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "optional-postage",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.591992Z",
     "start_time": "2021-02-20T17:22:25.295601Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div xmlns=\"http://www.w3.org/2000/svg\"><svg width=\"624pt\" height=\"204pt\" viewBox=\"0.00 0.00 624.00 204.00\">\n",
       "<g id=\"graph0\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 200)\">\n",
       "<title>%3</title>\n",
       "<polygon fill=\"white\" stroke=\"transparent\" points=\"-4,4 -4,-200 620,-200 620,4 -4,4\"></polygon>\n",
       "<g id=\"clust1\" class=\"cluster\">\n",
       "<title>cluster_elemental</title>\n",
       "<path fill=\"lightgrey\" stroke=\"white\" d=\"M20,-8C20,-8 596,-8 596,-8 602,-8 608,-14 608,-20 608,-20 608,-48 608,-48 608,-54 602,-60 596,-60 596,-60 20,-60 20,-60 14,-60 8,-54 8,-48 8,-48 8,-20 8,-20 8,-14 14,-8 20,-8\"></path>\n",
       "</g>\n",
       "\n",
       "<g id=\"node1\" class=\"node\">\n",
       "<title>0</title>\n",
       "<polygon fill=\"none\" stroke=\"black\" points=\"337,-172.44 364,-160 391,-172.44 390.97,-192.56 337.03,-192.56 337,-172.44\"></polygon>\n",
       "<text text-anchor=\"middle\" x=\"364\" y=\"-174.3\" font-family=\"Times,serif\" font-size=\"14.00\">0</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node8\" class=\"node\">\n",
       "<title>7</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M305,-124C305,-124 241,-124 241,-124 235,-124 229,-118 229,-112 229,-112 229,-100 229,-100 229,-94 235,-88 241,-88 241,-88 305,-88 305,-88 311,-88 317,-94 317,-100 317,-100 317,-112 317,-112 317,-118 311,-124 305,-124\"></path>\n",
       "<text text-anchor=\"start\" x=\"237\" y=\"-107.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(7) </text>\n",
       "<text text-anchor=\"start\" x=\"250\" y=\"-107.3\" font-family=\"Times,serif\" font-size=\"14.00\">Motorized</text>\n",
       "<text text-anchor=\"start\" x=\"254\" y=\"-97.3\" font-family=\"Times,serif\" font-style=\"italic\" font-size=\"9.00\" fill=\"#999999\">mu_motor</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge1\" class=\"edge\">\n",
       "<title>0-&gt;7</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M349.78,-166.06C337.47,-156.59 319.22,-142.56 303.61,-130.55\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"305.32,-127.45 295.26,-124.12 301.05,-133 305.32,-127.45\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"node9\" class=\"node\">\n",
       "<title>8</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M499,-124C499,-124 413,-124 413,-124 407,-124 401,-118 401,-112 401,-112 401,-100 401,-100 401,-94 407,-88 413,-88 413,-88 499,-88 499,-88 505,-88 511,-94 511,-100 511,-100 511,-112 511,-112 511,-118 505,-124 499,-124\"></path>\n",
       "<text text-anchor=\"start\" x=\"409\" y=\"-107.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(8) </text>\n",
       "<text text-anchor=\"start\" x=\"422\" y=\"-107.3\" font-family=\"Times,serif\" font-size=\"14.00\">Nonmotorized</text>\n",
       "<text text-anchor=\"start\" x=\"430.5\" y=\"-97.3\" font-family=\"Times,serif\" font-style=\"italic\" font-size=\"9.00\" fill=\"#999999\">mu_nonmotor</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge2\" class=\"edge\">\n",
       "<title>0-&gt;8</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M377.97,-166.37C390.56,-156.79 409.49,-142.39 425.56,-130.16\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"427.81,-132.85 433.65,-124.01 423.57,-127.28 427.81,-132.85\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"node2\" class=\"node\">\n",
       "<title>1</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"359\" cy=\"-34\" rx=\"32.49\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"342\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(1) </text>\n",
       "<text text-anchor=\"start\" x=\"355\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">DA</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node3\" class=\"node\">\n",
       "<title>2</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"273\" cy=\"-34\" rx=\"35.19\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"254\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(2) </text>\n",
       "<text text-anchor=\"start\" x=\"267\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">SR2</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node4\" class=\"node\">\n",
       "<title>3</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"185\" cy=\"-34\" rx=\"35.19\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"166\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(3) </text>\n",
       "<text text-anchor=\"start\" x=\"179\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">SR3</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node5\" class=\"node\">\n",
       "<title>4</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"74\" cy=\"-34\" rx=\"57.69\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"37.5\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(4) </text>\n",
       "<text text-anchor=\"start\" x=\"50.5\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">TRANSIT</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node6\" class=\"node\">\n",
       "<title>5</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"560\" cy=\"-34\" rx=\"40.09\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"537\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(5) </text>\n",
       "<text text-anchor=\"start\" x=\"550\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">BIKE</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"node7\" class=\"node\">\n",
       "<title>6</title>\n",
       "<ellipse fill=\"white\" stroke=\"black\" cx=\"456\" cy=\"-34\" rx=\"46.29\" ry=\"18\"></ellipse>\n",
       "<text text-anchor=\"start\" x=\"428.5\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"9.00\" fill=\"#999999\">(6) </text>\n",
       "<text text-anchor=\"start\" x=\"441.5\" y=\"-31.3\" font-family=\"Times,serif\" font-size=\"14.00\">WALK</text>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge3\" class=\"edge\">\n",
       "<title>7-&gt;1</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M294.26,-87.7C306.17,-78 321.11,-65.84 333.63,-55.65\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"335.91,-58.31 341.46,-49.28 331.49,-52.88 335.91,-58.31\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge4\" class=\"edge\">\n",
       "<title>7-&gt;2</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M273,-87.7C273,-79.98 273,-70.71 273,-62.11\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"276.5,-62.1 273,-52.1 269.5,-62.1 276.5,-62.1\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge5\" class=\"edge\">\n",
       "<title>7-&gt;3</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M251.25,-87.7C239.14,-78.07 223.98,-66.01 211.22,-55.86\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"213.24,-52.99 203.24,-49.51 208.89,-58.47 213.24,-52.99\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge6\" class=\"edge\">\n",
       "<title>7-&gt;4</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M228.89,-90.31C203.19,-81.67 170.19,-70.42 141,-60 133.93,-57.47 126.45,-54.75 119.17,-52.05\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"119.99,-48.63 109.4,-48.42 117.55,-55.19 119.99,-48.63\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge7\" class=\"edge\">\n",
       "<title>8-&gt;5</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M481.44,-87.88C496.12,-78 514.66,-65.52 530.04,-55.17\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"532.34,-57.84 538.68,-49.35 528.43,-52.03 532.34,-57.84\"></polygon>\n",
       "</g>\n",
       "\n",
       "<g id=\"edge8\" class=\"edge\">\n",
       "<title>8-&gt;6</title>\n",
       "<path fill=\"none\" stroke=\"black\" d=\"M456,-87.7C456,-79.98 456,-70.71 456,-62.11\"></path>\n",
       "<polygon fill=\"black\" stroke=\"black\" points=\"459.5,-62.1 456,-52.1 452.5,-62.1 459.5,-62.1\"></polygon>\n",
       "</g>\n",
       "</g>\n",
       "</svg></div>"
      ],
      "text/plain": [
       "<larch.model.tree.NestingTree at 0x7fe6b84c0640>"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "m2.graph"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "early-blogger",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.596634Z",
     "start_time": "2021-02-20T17:22:25.594034Z"
    }
   },
   "outputs": [],
   "source": [
    "u = np.zeros([10,9])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "sweet-pontiac",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.604757Z",
     "start_time": "2021-02-20T17:22:25.598672Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.6667   , 0.3333   , 1        ],\n",
       "       [0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.6667   , 0.3333   , 1        ],\n",
       "       [0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.6667   , 0.3333   , 1        ],\n",
       "       [0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.6667   , 0.3333   , 1        ],\n",
       "       [0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.6667   , 0.3333   , 1        ],\n",
       "       [0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.6667   , 0.3333   , 1        ],\n",
       "       [0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.6667   , 0.3333   , 1        ],\n",
       "       [0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.6667   , 0.3333   , 1        ],\n",
       "       [0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.6667   , 0.3333   , 1        ],\n",
       "       [0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.1667   , 0.6667   , 0.3333   , 1        ]])"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "m2.probability_from_utility(u)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "substantial-morocco",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.611351Z",
     "start_time": "2021-02-20T17:22:25.606680Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([1.792    , 1.792    , 1.792    , 1.792    , 1.792    , 1.792    , 1.792    , 1.792    , 1.792    , 1.792    ])"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "m2.logsums_from_utility(u)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "announced-bridges",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-20T17:22:25.616712Z",
     "start_time": "2021-02-20T17:22:25.613195Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([1.792    , 1.792    , 1.792    , 1.792    , 1.792    , 1.792    , 1.792    , 1.792    , 1.792    , 1.792    ])"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "u[:,-1]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "periodic-brother",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T15:48:26.523742Z",
     "start_time": "2021-02-21T15:48:25.514953Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'assign_variables in 1004.2: '"
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import time\n",
    "pre_time = time.time()\n",
    "time.sleep(1)\n",
    "(f\"assign_variables in {(time.time()-pre_time)*1000:.1f}: \")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "id": "treated-mercury",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T17:27:31.295265Z",
     "start_time": "2021-02-21T17:27:31.292561Z"
    }
   },
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "from activitysim.core.util import reindex"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "id": "organized-washer",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T17:27:31.659191Z",
     "start_time": "2021-02-21T17:27:31.655981Z"
    }
   },
   "outputs": [],
   "source": [
    "#one = pd.Series([11,22,33,44,55], index=[111,222,333,444,555])\n",
    "one = pd.Series(np.arange(5000)*11, index=np.arange(5000)*111)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 61,
   "id": "middle-invasion",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T17:27:32.205596Z",
     "start_time": "2021-02-21T17:27:32.203291Z"
    }
   },
   "outputs": [],
   "source": [
    "#two = pd.Series([111,222,333,444,555,444,111], index=[21,22,23,24,25,26,27])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 62,
   "id": "enabling-cotton",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T17:27:32.654834Z",
     "start_time": "2021-02-21T17:27:32.651535Z"
    }
   },
   "outputs": [],
   "source": [
    "two = pd.Series(\n",
    "    np.random.choice(np.arange(5000)*111, 15000), \n",
    "    index=np.arange(15000)+720000000\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 63,
   "id": "possible-round",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T17:27:47.836959Z",
     "start_time": "2021-02-21T17:27:34.961769Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "1.57 ms ± 16.3 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)\n"
     ]
    }
   ],
   "source": [
    "%timeit reindex(one,two)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 64,
   "id": "unique-magic",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T17:27:54.228808Z",
     "start_time": "2021-02-21T17:27:54.225946Z"
    }
   },
   "outputs": [],
   "source": [
    "def reindex3(a,b):\n",
    "    s = a.loc[b].reset_index(drop=True)\n",
    "    s.index = b.index\n",
    "    return s"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 97,
   "id": "sweet-optics",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T19:54:07.038032Z",
     "start_time": "2021-02-21T19:54:07.035531Z"
    }
   },
   "outputs": [],
   "source": [
    "def reindex4(series1, series2):\n",
    "    #return pd.Series(series1.loc[series2.values].values, index=None)\n",
    "    return pd.Series(series1.reindex(series2.values).values, index=getattr(series2,'index', series2))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 93,
   "id": "later-census",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T19:51:53.860003Z",
     "start_time": "2021-02-21T19:51:53.854103Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>left</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   left\n",
       "0     0\n",
       "1     1\n",
       "2     2\n",
       "3     3\n",
       "4     4\n",
       "5     5"
      ]
     },
     "execution_count": 93,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pd.RangeIndex(6).to_frame(name='left')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 87,
   "id": "knowing-constant",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T19:33:35.312475Z",
     "start_time": "2021-02-21T19:33:22.483716Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "1.58 ms ± 22.5 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)\n"
     ]
    }
   ],
   "source": [
    "%timeit reindex(one,two)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 90,
   "id": "passing-scott",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T19:34:01.820677Z",
     "start_time": "2021-02-21T19:33:59.634171Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "266 µs ± 13.6 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)\n"
     ]
    }
   ],
   "source": [
    "%timeit reindex4(one,two)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 72,
   "id": "romantic-barrier",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T19:26:30.408874Z",
     "start_time": "2021-02-21T19:26:30.403555Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0        34683\n",
       "1         5577\n",
       "2         1639\n",
       "3         9988\n",
       "4        48235\n",
       "         ...  \n",
       "14995    20933\n",
       "14996    42856\n",
       "14997    13266\n",
       "14998    34518\n",
       "14999    45859\n",
       "Length: 15000, dtype: int64"
      ]
     },
     "execution_count": 72,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "reindex4(one,two)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 73,
   "id": "reserved-gauge",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T19:26:38.538142Z",
     "start_time": "2021-02-21T19:26:38.530786Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "720000000    34683\n",
       "720000001     5577\n",
       "720000002     1639\n",
       "720000003     9988\n",
       "720000004    48235\n",
       "             ...  \n",
       "720014995    20933\n",
       "720014996    42856\n",
       "720014997    13266\n",
       "720014998    34518\n",
       "720014999    45859\n",
       "Name: right, Length: 15000, dtype: int64"
      ]
     },
     "execution_count": 73,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "reindex(one,two)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 98,
   "id": "continued-rabbit",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T19:54:13.447128Z",
     "start_time": "2021-02-21T19:54:13.444181Z"
    }
   },
   "outputs": [],
   "source": [
    "two1 = pd.Series(\n",
    "    [111, 29387498], \n",
    "    index=[55,56]\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 99,
   "id": "executive-talent",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T19:54:17.427994Z",
     "start_time": "2021-02-21T19:54:17.423129Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "108     NaN\n",
       "109     NaN\n",
       "110     NaN\n",
       "111    11.0\n",
       "112     NaN\n",
       "113     NaN\n",
       "dtype: float64"
      ]
     },
     "execution_count": 99,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "reindex4(one,pd.RangeIndex(108,114))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 95,
   "id": "stock-hospital",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T19:52:41.778172Z",
     "start_time": "2021-02-21T19:52:41.773905Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0             0\n",
       "111          11\n",
       "222          22\n",
       "333          33\n",
       "444          44\n",
       "          ...  \n",
       "554445    54945\n",
       "554556    54956\n",
       "554667    54967\n",
       "554778    54978\n",
       "554889    54989\n",
       "Length: 5000, dtype: int64"
      ]
     },
     "execution_count": 95,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "one"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 80,
   "id": "least-generator",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-02-21T19:30:08.543136Z",
     "start_time": "2021-02-21T19:30:08.537953Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "55    11.0\n",
       "56     NaN\n",
       "dtype: float64"
      ]
     },
     "execution_count": 80,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pd.Series(one.reindex(two1).values, index=two1.index)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "republican-belief",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.6"
  },
  "toc": {
   "base_numbering": 1,
   "nav_menu": {},
   "number_sections": true,
   "sideBar": true,
   "skip_h1_title": false,
   "title_cell": "Table of Contents",
   "title_sidebar": "Contents",
   "toc_cell": false,
   "toc_position": {},
   "toc_section_display": true,
   "toc_window_display": false
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
