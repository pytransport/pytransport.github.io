

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Manipulating Geographic Data &mdash; Python for Transportation 1.1.2, June 2022 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Accessing OpenStreetMap Data" href="accessing-openstreetmap.html" />
    <link rel="prev" title="Geographic Analysis" href="_index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Python for Transportation
          

          
          </a>

          
            
            
              <div class="version">
                1.1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../starting/_index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic-python/_index.html">Python Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tabular-analysis/_index.html">Tabular Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/_index.html">Data Visualization</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_index.html">Geographic Analysis</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Manipulating Geographic Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Loading-a-Shapefile">Loading a Shapefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Coordinate-Reference-Systems">Coordinate Reference Systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Selecting-by-Geography">Selecting by Geography</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Selection-by-Rectangular-Envelope">Selection by Rectangular Envelope</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Selection-by-Polygon">Selection by Polygon</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Clipping-by-Geography">Clipping by Geography</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Joining-by-Geography">Joining by Geography</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Managing-Errors-in-Joining-Spatial-Data">Managing Errors in Joining Spatial Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Creating-a-Crosswalk-Dictionary-from-the-Joined-Data">Creating a Crosswalk Dictionary from the Joined Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="accessing-openstreetmap.html">Accessing OpenStreetMap Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="static-maps.html">Creating Static Maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic-maps.html">Creating Dynamic Maps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../choice-modeling/_index.html">Discrete Choice Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/_index.html">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/example-data.html">Tutorial Data Files</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python for Transportation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="_index.html">Geographic Analysis</a> &raquo;</li>
        
      <li>Manipulating Geographic Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/course-content/geographic-analysis/working-with-geodata.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Manipulating-Geographic-Data">
<h1>Manipulating Geographic Data<a class="headerlink" href="#Manipulating-Geographic-Data" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/jpn--/python-for-transportation-modeling/blob/master/course-content/geographic-analysis/working-with-geodata.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>A <a class="reference external" href="https://en.wikipedia.org/wiki/Shapefile">shapefile</a> is a data format that is actually a set of files containing geospatial information. All of the related files have the same filename (except for the file extension) and must reside in the same directory. Generally, there will be files with the <code class="docutils literal notranslate"><span class="pre">shp</span></code> extension containing geographic data, the <code class="docutils literal notranslate"><span class="pre">dbf</span></code> extension containing tabular data, and a few others. The files can be read into python as a group and manipulated using the
<a class="reference external" href="http://geopandas.org">GeoPandas</a> package.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!python -m pip install &quot;git+https://github.com/jpn--/python-for-transportation-modeling.git#egg=transportation-tutorials&amp;subdirectory=example-package&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">transportation_tutorials</span> <span class="k">as</span> <span class="nn">tt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
</pre></div>
</div>
</div>
<div class="section" id="Loading-a-Shapefile">
<h2>Loading a Shapefile<a class="headerlink" href="#Loading-a-Shapefile" title="Permalink to this headline">¶</a></h2>
<p>Let’s load the SERPM8 TAZ shapefile. This shapefile (actually a set of files) is included in the data of the tuturials package and can be accessed as shown. Loading a shapefile into Python using geopandas is a simple task using the <a class="reference external" href="http://geopandas.org/reference/geopandas.read_file.html">read_file</a> function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shapefile_filename</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;SERPM8-TAZSHAPE&#39;</span><span class="p">)</span>
<span class="n">taz</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">shapefile_filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This will load the shapefile into a <a class="reference external" href="http://geopandas.org/reference.html#geodataframe">GeoDataFrame</a> object, which is similar to a pandas DataFrame, but with a special <em>geometry</em> column that contains, as you might guess, geometric shape data contained in the <em>shp</em> part of the shapefile. It also includes all the other various tabular data contained in the <em>dbf</em> part of the shapefile. We can inspect the first few lines of the GeoDataFrame to see the contents, just like a regular DataFrame:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>TAZ_REG</th>
      <th>TAZ_OLD05</th>
      <th>TAZ_MPO</th>
      <th>COUNTY</th>
      <th>CENSUSTAZ</th>
      <th>TAZ_BF</th>
      <th>FIX</th>
      <th>AREA</th>
      <th>F_NETAREA</th>
      <th>CBD</th>
      <th>HM_ROOMS</th>
      <th>Shape_Leng</th>
      <th>Shape_Area</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1122.0</td>
      <td>1122</td>
      <td>1122</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>4442490.0</td>
      <td>0.8153</td>
      <td>0</td>
      <td>0</td>
      <td>10592.846522</td>
      <td>4.442490e+06</td>
      <td>POLYGON ((936374.674 959539.568, 936373.444 95...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>17.0</td>
      <td>17</td>
      <td>17</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>15689400.0</td>
      <td>0.8571</td>
      <td>0</td>
      <td>0</td>
      <td>17396.297932</td>
      <td>1.568938e+07</td>
      <td>POLYGON ((942254.500 952920.937, 942255.812 95...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1123.0</td>
      <td>1123</td>
      <td>1123</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>17396100.0</td>
      <td>0.8663</td>
      <td>0</td>
      <td>0</td>
      <td>23585.421941</td>
      <td>1.739613e+07</td>
      <td>POLYGON ((940953.561 952985.069, 940953.437 95...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1120.0</td>
      <td>1120</td>
      <td>1120</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>1303420.0</td>
      <td>0.8536</td>
      <td>0</td>
      <td>0</td>
      <td>7202.864864</td>
      <td>1.303422e+06</td>
      <td>POLYGON ((953119.000 951985.375, 953045.807 95...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1121.0</td>
      <td>1121</td>
      <td>1121</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>31477500.0</td>
      <td>0.8787</td>
      <td>0</td>
      <td>0</td>
      <td>24940.959492</td>
      <td>3.147748e+07</td>
      <td>POLYGON ((934328.283 951600.585, 934327.451 94...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Because this is the TAZ shapefile, we expect that the geometry column includes a set of <a class="reference external" href="https://shapely.readthedocs.io/en/stable/manual.html#polygons">Polygon</a> values, as we can observe in the first few rows. We can also easily check how many zones are included in the file by checking the length of the GeoDataFrame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;geopandas.geodataframe.GeoDataFrame&#39;&gt;
RangeIndex: 4236 entries, 0 to 4235
Data columns (total 15 columns):
 #   Column      Non-Null Count  Dtype
---  ------      --------------  -----
 0   OBJECTID    4236 non-null   int64
 1   TAZ_REG     4236 non-null   float64
 2   TAZ_OLD05   4236 non-null   int64
 3   TAZ_MPO     4236 non-null   int64
 4   COUNTY      4236 non-null   float64
 5   CENSUSTAZ   1506 non-null   object
 6   TAZ_BF      4236 non-null   int64
 7   FIX         4236 non-null   int64
 8   AREA        4236 non-null   float64
 9   F_NETAREA   4236 non-null   float64
 10  CBD         4236 non-null   int64
 11  HM_ROOMS    4236 non-null   int64
 12  Shape_Leng  4236 non-null   float64
 13  Shape_Area  4236 non-null   float64
 14  geometry    4236 non-null   geometry
dtypes: float64(6), geometry(1), int64(7), object(1)
memory usage: 496.5+ KB
</pre></div></div>
</div>
<p>Displaying the shapefile in a jupyter notebook can be accomplished by calling the <a class="reference external" href="http://geopandas.org/reference.html?highlight=plot#geopandas.GeoDataFrame.plot">plot</a> method of the GeoDataFrame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">taz</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_12_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_12_0.png" />
</div>
</div>
</div>
<div class="section" id="Coordinate-Reference-Systems">
<h2>Coordinate Reference Systems<a class="headerlink" href="#Coordinate-Reference-Systems" title="Permalink to this headline">¶</a></h2>
<p>You might notice that the axis labels don’t show latitude and longitude. That’s because the TAZ file uses a different coordinate reference system (<em>crs</em>) for map projection. We can find what crs is being used by accessing the <a class="reference external" href="http://geopandas.org/projections.html#coordinate-reference-systems">crs</a> attribute.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Derived Projected CRS: PROJCS[&#34;NAD83 / Florida East (ftUS)&#34;,GEOGCS[&#34;NAD83 ...&gt;
Name: NAD83 / Florida East (ftUS)
Axis Info [cartesian]:
- [east]: Easting (US survey foot)
- [north]: Northing (US survey foot)
Area of Use:
- undefined
Coordinate Operation:
- name: unnamed
- method: Transverse Mercator
Datum: North American Datum 1983
- Ellipsoid: GRS 1980
- Prime Meridian: Greenwich
</pre></div></div>
</div>
<p>Drop that code into <a class="reference external" href="http://www.google.com/search?q=epsg%3A2236">Google</a> and you’ll find that it’s a special coordinate system for <a class="reference external" href="https://spatialreference.org/ref/epsg/nad83-florida-east-ftus/">mapping and engineering in eastern Florida</a>, which for this application may be perfectly reasonable. However, suppose we want to generate maps using plain old latitude and longitude. We can convert between CRS systems easily, like this:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz1</span> <span class="o">=</span> <span class="n">taz</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">taz1</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_17_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_17_0.png" />
</div>
</div>
<p>The map projection generated here is subtly different from the previous one. If you look carefully, you’ll note the shape of the second map is a bit wider than first. This distortion is a natural part of the mapping projection, using plain latitude and longitude, as one degree of longitude is a different distance than one degree of latitude. In Florida, the difference is relatively small, but it grows as you move north.</p>
</div>
<div class="section" id="Selecting-by-Geography">
<h2>Selecting by Geography<a class="headerlink" href="#Selecting-by-Geography" title="Permalink to this headline">¶</a></h2>
<p>The SERPM8 region is quite large. Let’s suppose we only want to study a small portion of this region. Since we are working with Jupyter notebooks, we’ll select an area to study around Jupiter, Florida.</p>
<div class="section" id="Selection-by-Rectangular-Envelope">
<h3>Selection by Rectangular Envelope<a class="headerlink" href="#Selection-by-Rectangular-Envelope" title="Permalink to this headline">¶</a></h3>
<p>We can explicitly define some bounds for our study area:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xmin</span> <span class="o">=</span> <span class="mf">905712.145924</span>
<span class="n">ymin</span> <span class="o">=</span> <span class="mf">905343.94408855</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mf">983346.68922847</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="mf">981695.93140023</span>
</pre></div>
</div>
</div>
<p>Then, to select only the TAZ’s that are (at least partially) contained in the study area, we can use the <code class="docutils literal notranslate"><span class="pre">cx</span></code> indexer on GeoDataFrames. This indexer works similarly to the <code class="docutils literal notranslate"><span class="pre">loc</span></code> and <code class="docutils literal notranslate"><span class="pre">iloc</span></code> indexers on regular DataFrames, but selects not based on labels or tabular position, but instead selects based on geographic position.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz_jupiter</span> <span class="o">=</span> <span class="n">taz</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>The result of the selection is another GeoDataFrame, just as slicing using the <code class="docutils literal notranslate"><span class="pre">loc</span></code>and <code class="docutils literal notranslate"><span class="pre">iloc</span></code> indexers on regular DataFrames creates a new DataFrame. Thus, we can review how many TAZ’s are in the selection in the same manner as we checked the number of TAZ’s in the original shapefile.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">taz_jupiter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
220
</pre></div></div>
</div>
<p>And we can plot a map of the selected area, just as we did with the original data. Here, we’ll draw the borders of the TAZ’s in white for better contrast.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">taz_jupiter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_28_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_28_0.png" />
</div>
</div>
<p>Because Jupiter is in the northwest corner of the SERPM region, only the south and west boundaries of the study area are relevant in the selection definition. Convenietly, just like other DataFrame indexers, the <code class="docutils literal notranslate"><span class="pre">cx</span></code> indexer allows for one-sided slices.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz_jupiter2</span> <span class="o">=</span> <span class="n">taz</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="n">xmin</span><span class="p">:,</span> <span class="n">ymin</span><span class="p">:]</span>
<span class="n">taz_jupiter2</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">taz_jupiter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>One important note regarding the <code class="docutils literal notranslate"><span class="pre">cx</span></code> indexer is that it will select all features that are contained fully <em>or partially</em> in the selection area. To illustrate, we can construct a GeoDataFrame consisting of the study area box, and draw it on a map of the selected zones.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">box</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">CRS</span>
<span class="n">study_area</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">box</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)],</span> <span class="n">crs</span><span class="o">=</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">2236</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">study_area</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>POLYGON ((983346.689 905343.944, 983346.689 98...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">taz_jupiter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">transparent</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">study_area</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">transparent</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_34_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_34_0.png" />
</div>
</div>
</div>
<div class="section" id="Selection-by-Polygon">
<h3>Selection by Polygon<a class="headerlink" href="#Selection-by-Polygon" title="Permalink to this headline">¶</a></h3>
<p>If the study area is not neatly defined by a rectangle but instead by some defined irregular polygon, it is still possible to filter the GeoDataFrame, but slightly more complicated. We’ll demonstrate by first constructing an irregular polygon.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="n">irregular_polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">973346</span><span class="p">,</span> <span class="mi">935343</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">973346</span><span class="p">,</span> <span class="mi">971695</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">912812</span><span class="p">,</span> <span class="mi">973695</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">915812</span><span class="p">,</span> <span class="mi">943695</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">928812</span><span class="p">,</span> <span class="mi">943695</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">935712</span><span class="p">,</span> <span class="mi">905343</span><span class="p">),</span>
<span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">taz_jupiter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">irregular_polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_36_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_36_0.png" />
</div>
</div>
<p>To indentify those TAZ polygons that touch the polygon, we can use the <code class="docutils literal notranslate"><span class="pre">intersects</span></code> method of GeoDataFrames.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz_jupiter</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">irregular_polygon</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0       True
1       True
2       True
3       True
4       True
        ...
1641    True
1642    True
1643    True
1644    True
1645    True
Length: 220, dtype: bool
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz_jupiter</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>TAZ_REG</th>
      <th>TAZ_OLD05</th>
      <th>TAZ_MPO</th>
      <th>COUNTY</th>
      <th>CENSUSTAZ</th>
      <th>TAZ_BF</th>
      <th>FIX</th>
      <th>AREA</th>
      <th>F_NETAREA</th>
      <th>CBD</th>
      <th>HM_ROOMS</th>
      <th>Shape_Leng</th>
      <th>Shape_Area</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1122.0</td>
      <td>1122</td>
      <td>1122</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>4442490.0</td>
      <td>0.8153</td>
      <td>0</td>
      <td>0</td>
      <td>10592.846522</td>
      <td>4.442490e+06</td>
      <td>POLYGON ((936374.674 959539.568, 936373.444 95...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>17.0</td>
      <td>17</td>
      <td>17</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>15689400.0</td>
      <td>0.8571</td>
      <td>0</td>
      <td>0</td>
      <td>17396.297932</td>
      <td>1.568938e+07</td>
      <td>POLYGON ((942254.500 952920.937, 942255.812 95...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1123.0</td>
      <td>1123</td>
      <td>1123</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>17396100.0</td>
      <td>0.8663</td>
      <td>0</td>
      <td>0</td>
      <td>23585.421941</td>
      <td>1.739613e+07</td>
      <td>POLYGON ((940953.561 952985.069, 940953.437 95...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1120.0</td>
      <td>1120</td>
      <td>1120</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>1303420.0</td>
      <td>0.8536</td>
      <td>0</td>
      <td>0</td>
      <td>7202.864864</td>
      <td>1.303422e+06</td>
      <td>POLYGON ((953119.000 951985.375, 953045.807 95...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1121.0</td>
      <td>1121</td>
      <td>1121</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>31477500.0</td>
      <td>0.8787</td>
      <td>0</td>
      <td>0</td>
      <td>24940.959492</td>
      <td>3.147748e+07</td>
      <td>POLYGON ((934328.283 951600.585, 934327.451 94...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1641</th>
      <td>1642</td>
      <td>1571.0</td>
      <td>1571</td>
      <td>1571</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>2175400.0</td>
      <td>0.8139</td>
      <td>0</td>
      <td>0</td>
      <td>8175.287650</td>
      <td>2.175399e+06</td>
      <td>POLYGON ((948645.617 938369.478, 948477.396 93...</td>
    </tr>
    <tr>
      <th>1642</th>
      <td>1643</td>
      <td>41.0</td>
      <td>41</td>
      <td>41</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>3112200.0</td>
      <td>0.8035</td>
      <td>0</td>
      <td>0</td>
      <td>7365.584371</td>
      <td>3.112197e+06</td>
      <td>POLYGON ((948260.308 941116.742, 948033.694 94...</td>
    </tr>
    <tr>
      <th>1643</th>
      <td>1644</td>
      <td>25.0</td>
      <td>25</td>
      <td>25</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>16108500.0</td>
      <td>0.9281</td>
      <td>0</td>
      <td>0</td>
      <td>18997.481697</td>
      <td>1.610847e+07</td>
      <td>POLYGON ((942059.220 931753.801, 942017.697 93...</td>
    </tr>
    <tr>
      <th>1644</th>
      <td>1645</td>
      <td>1569.0</td>
      <td>1569</td>
      <td>1569</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>7811080.0</td>
      <td>1.0000</td>
      <td>0</td>
      <td>0</td>
      <td>11310.786358</td>
      <td>7.811077e+06</td>
      <td>POLYGON ((944289.070 933071.090, 944242.356 93...</td>
    </tr>
    <tr>
      <th>1645</th>
      <td>1646</td>
      <td>1568.0</td>
      <td>1568</td>
      <td>1568</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>6621250.0</td>
      <td>0.9903</td>
      <td>0</td>
      <td>0</td>
      <td>10829.364010</td>
      <td>6.621252e+06</td>
      <td>POLYGON ((943816.397 938019.963, 945307.352 93...</td>
    </tr>
  </tbody>
</table>
<p>220 rows × 15 columns</p>
</div></div>
</div>
<p>This gives us a series that matches the GeoDataFrame, and identifies whether each row’s geometry intersects the the polygon. We can use that to filter the rows, to retain only those TAZ’s of interest.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz_jupiter_irregular</span> <span class="o">=</span> <span class="n">taz_jupiter</span><span class="p">[</span><span class="n">taz_jupiter</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">irregular_polygon</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">taz_jupiter_irregular</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
146
</pre></div></div>
</div>
<p>This gives us a new GeoDataFrame that is potentially just a filtered view of the original, which can potentially lead to problems later (<a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy">see here</a>). To ensure we have a bonafide new GeoDataFrame, we can make sure it is a copy.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz_jupiter_irregular</span> <span class="o">=</span> <span class="n">taz_jupiter_irregular</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">taz_jupiter_irregular</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">irregular_polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_45_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_45_0.png" />
</div>
</div>
<p>You may note, as with the rectangular selection, we still select any zone that has any part of the zone inside the polygon.</p>
</div>
</div>
<div class="section" id="Clipping-by-Geography">
<h2>Clipping by Geography<a class="headerlink" href="#Clipping-by-Geography" title="Permalink to this headline">¶</a></h2>
<p>If instead we want to actually clip the geographic data at the study area frame, we can use the <code class="docutils literal notranslate"><span class="pre">overlay</span></code> function to get the intersection of the TAZ’s and the study area.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz_jupiter_clip</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">taz</span><span class="p">,</span> <span class="n">study_area</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">taz</span><span class="o">.</span><span class="n">crs</span><span class="p">),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>By taking the intersection, we discard portions of the zone shapes that are outside the study area, as is illustrated when we map the results with the study area box.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">taz_jupiter_clip</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">transparent</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">study_area</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">transparent</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_51_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_51_0.png" />
</div>
</div>
<p>Alternatively, if we have a polygon, we can use <code class="docutils literal notranslate"><span class="pre">intersection</span></code> to trim the GeoDataFrame geometry to only the overlapping areas.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz_jupiter_irregular</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">taz_jupiter_irregular</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">irregular_polygon</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz_jupiter_irregular</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>TAZ_REG</th>
      <th>TAZ_OLD05</th>
      <th>TAZ_MPO</th>
      <th>COUNTY</th>
      <th>CENSUSTAZ</th>
      <th>TAZ_BF</th>
      <th>FIX</th>
      <th>AREA</th>
      <th>F_NETAREA</th>
      <th>CBD</th>
      <th>HM_ROOMS</th>
      <th>Shape_Leng</th>
      <th>Shape_Area</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1122.0</td>
      <td>1122</td>
      <td>1122</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>4442490.0</td>
      <td>0.8153</td>
      <td>0</td>
      <td>0</td>
      <td>10592.846522</td>
      <td>4.442490e+06</td>
      <td>POLYGON ((936373.444 958211.473, 936985.437 95...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>17.0</td>
      <td>17</td>
      <td>17</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>15689400.0</td>
      <td>0.8571</td>
      <td>0</td>
      <td>0</td>
      <td>17396.297932</td>
      <td>1.568938e+07</td>
      <td>POLYGON ((942255.812 952648.750, 942256.500 95...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1123.0</td>
      <td>1123</td>
      <td>1123</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>17396100.0</td>
      <td>0.8663</td>
      <td>0</td>
      <td>0</td>
      <td>23585.421941</td>
      <td>1.739613e+07</td>
      <td>POLYGON ((940953.437 952905.027, 938308.351 95...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1120.0</td>
      <td>1120</td>
      <td>1120</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>1303420.0</td>
      <td>0.8536</td>
      <td>0</td>
      <td>0</td>
      <td>7202.864864</td>
      <td>1.303422e+06</td>
      <td>POLYGON ((953045.807 952005.661, 953036.379 95...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1121.0</td>
      <td>1121</td>
      <td>1121</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>31477500.0</td>
      <td>0.8787</td>
      <td>0</td>
      <td>0</td>
      <td>24940.959492</td>
      <td>3.147748e+07</td>
      <td>POLYGON ((934327.451 948958.968, 934225.673 94...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1641</th>
      <td>1642</td>
      <td>1571.0</td>
      <td>1571</td>
      <td>1571</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>2175400.0</td>
      <td>0.8139</td>
      <td>0</td>
      <td>0</td>
      <td>8175.287650</td>
      <td>2.175399e+06</td>
      <td>POLYGON ((948477.396 938417.383, 948358.410 93...</td>
    </tr>
    <tr>
      <th>1642</th>
      <td>1643</td>
      <td>41.0</td>
      <td>41</td>
      <td>41</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>3112200.0</td>
      <td>0.8035</td>
      <td>0</td>
      <td>0</td>
      <td>7365.584371</td>
      <td>3.112197e+06</td>
      <td>POLYGON ((948033.694 941108.067, 947377.033 94...</td>
    </tr>
    <tr>
      <th>1643</th>
      <td>1644</td>
      <td>25.0</td>
      <td>25</td>
      <td>25</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>16108500.0</td>
      <td>0.9281</td>
      <td>0</td>
      <td>0</td>
      <td>18997.481697</td>
      <td>1.610847e+07</td>
      <td>POLYGON ((942017.697 931747.864, 941995.151 93...</td>
    </tr>
    <tr>
      <th>1644</th>
      <td>1645</td>
      <td>1569.0</td>
      <td>1569</td>
      <td>1569</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>7811080.0</td>
      <td>1.0000</td>
      <td>0</td>
      <td>0</td>
      <td>11310.786358</td>
      <td>7.811077e+06</td>
      <td>POLYGON ((944242.356 933263.091, 944127.723 93...</td>
    </tr>
    <tr>
      <th>1645</th>
      <td>1646</td>
      <td>1568.0</td>
      <td>1568</td>
      <td>1568</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>6621250.0</td>
      <td>0.9903</td>
      <td>0</td>
      <td>0</td>
      <td>10829.364010</td>
      <td>6.621252e+06</td>
      <td>POLYGON ((945307.352 937972.424, 945701.891 93...</td>
    </tr>
  </tbody>
</table>
<p>146 rows × 15 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">taz_jupiter_irregular</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">transparent</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">irregular_polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_55_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_55_0.png" />
</div>
</div>
<p>An important feature to consider if using this method is that the operation does not actually change the set of rows or any other data included in the GeoDataFrame. If, for example, we apply it to the set of TAZ’s from the square clipped region, we can get a map that looks identical, but the GeoDataFrame will still retain all the data rows from the previous version, just with some geometry values set as empty.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">taz_jupiter_clip</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">taz_jupiter_clip</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">irregular_polygon</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">taz_jupiter_clip</span><span class="p">[</span><span class="n">taz_jupiter_clip</span><span class="o">.</span><span class="n">area</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">transparent</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">irregular_polygon</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_57_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_57_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">taz_jupiter_irregular</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">taz_jupiter_clip</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(146, 220)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sum</span><span class="p">(</span><span class="n">taz_jupiter_clip</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
74
</pre></div></div>
</div>
</div>
<div class="section" id="Joining-by-Geography">
<h2>Joining by Geography<a class="headerlink" href="#Joining-by-Geography" title="Permalink to this headline">¶</a></h2>
<p>A common task in geographic analysis is joining two sets of geographic data together. We actually did a simple version of this just above, when we joined the TAZ data with the study area, although the study area had only a single polygon and no other associated data, so the results are not particularly inspiring.</p>
<p>As a more sophisticated example, let’s consider the micro-area zone (MAZ) system from SERPM8. The MAZ are smaller zones nested inside TAZ’s, used to provide a higher resolution of data, particularly for transit travel. Using the TAZ system is sometimes too coarse for this purpose, as it may be convenient to walk to a bus stop located on a TAZ boundary only for some parts of the zone, while the walking from the far side of the same TAZ to the bus stop might be unreasonably far.</p>
<p>Like the TAZ system, the MAZ system for SERPM8 is given by a shape file, and is included in the tutorial data, so we can load it in the same way.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mazshape_filename</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;SERPM8-MAZSHAPE&#39;</span><span class="p">)</span>
<span class="n">maz</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">mazshape_filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">maz</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
12022
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID</th>
      <th>MAZ</th>
      <th>SHAPE_LENG</th>
      <th>SHAPE_AREA</th>
      <th>ACRES</th>
      <th>POINT_X</th>
      <th>POINT_Y</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>5347</td>
      <td>8589.393674</td>
      <td>3.111034e+06</td>
      <td>71</td>
      <td>953130</td>
      <td>724165</td>
      <td>POLYGON ((953970.466 723936.081, 953972.382 72...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>5348</td>
      <td>11974.067469</td>
      <td>7.628753e+06</td>
      <td>175</td>
      <td>907018</td>
      <td>634551</td>
      <td>POLYGON ((908505.280 635081.774, 908488.945 63...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>5349</td>
      <td>9446.131753</td>
      <td>4.007041e+06</td>
      <td>92</td>
      <td>923725</td>
      <td>707062</td>
      <td>POLYGON ((922736.637 708387.692, 923950.960 70...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>5350</td>
      <td>21773.153739</td>
      <td>2.487397e+07</td>
      <td>571</td>
      <td>908988</td>
      <td>713484</td>
      <td>POLYGON ((908334.237 715692.263, 908714.653 71...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>5351</td>
      <td>17882.701416</td>
      <td>1.963139e+07</td>
      <td>451</td>
      <td>909221</td>
      <td>717493</td>
      <td>POLYGON ((911883.019 719309.326, 911940.995 71...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_65_1.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_65_1.png" />
</div>
</div>
<p>We can select only MAZ’s in the study area in the same manner as we did for TAZ’s.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz_jupiter</span> <span class="o">=</span> <span class="n">maz</span><span class="o">.</span><span class="n">cx</span><span class="p">[</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">maz_jupiter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
361
</pre></div></div>
</div>
<p>To create a joined GeoDataFrame, we can use the same <code class="docutils literal notranslate"><span class="pre">`overlay</span></code> &lt;<a class="reference external" href="http://geopandas.org/reference/geopandas.overlay.html">http://geopandas.org/reference/geopandas.overlay.html</a>&gt;`__ function we used to clip the TAZ’s, although we will intersect the TAZ and MAZ geometries.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz_taz</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">maz_jupiter</span><span class="p">,</span> <span class="n">taz_jupiter</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/ipykernel_17811/2244847169.py:1: UserWarning: `keep_geom_type=True` in overlay resulted in 1521 dropped geometries of different geometry types than df1 has. Set `keep_geom_type=False` to retain all geometries
  maz_taz = gpd.overlay(maz_jupiter, taz_jupiter, how=&#39;intersection&#39;)
</pre></div></div>
</div>
<p>The joined GeoDataFrame has all the columns from both the MAZ and TAZ source data. In cases where both source tables have an identically named column (for example, “OBJECTID”) then both columns are retained, and they are labeled with “_1” and “_2” suffixes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz_taz</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID_1</th>
      <th>MAZ</th>
      <th>SHAPE_LENG</th>
      <th>SHAPE_AREA</th>
      <th>ACRES</th>
      <th>POINT_X</th>
      <th>POINT_Y</th>
      <th>OBJECTID_2</th>
      <th>TAZ_REG</th>
      <th>TAZ_OLD05</th>
      <th>...</th>
      <th>CENSUSTAZ</th>
      <th>TAZ_BF</th>
      <th>FIX</th>
      <th>AREA</th>
      <th>F_NETAREA</th>
      <th>CBD</th>
      <th>HM_ROOMS</th>
      <th>Shape_Leng</th>
      <th>Shape_Area</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2389</td>
      <td>7736</td>
      <td>10592.846522</td>
      <td>4.442490e+06</td>
      <td>102</td>
      <td>936259</td>
      <td>957308</td>
      <td>1</td>
      <td>1122.0</td>
      <td>1122</td>
      <td>...</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>4442490.0</td>
      <td>0.8153</td>
      <td>0</td>
      <td>0</td>
      <td>10592.846522</td>
      <td>4.442490e+06</td>
      <td>POLYGON ((936373.444 958211.473, 936985.437 95...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2390</td>
      <td>7737</td>
      <td>17396.297932</td>
      <td>1.568938e+07</td>
      <td>360</td>
      <td>940102</td>
      <td>950911</td>
      <td>3</td>
      <td>1123.0</td>
      <td>1123</td>
      <td>...</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>17396100.0</td>
      <td>0.8663</td>
      <td>0</td>
      <td>0</td>
      <td>23585.421941</td>
      <td>1.739613e+07</td>
      <td>POLYGON ((938309.917 952656.485, 938308.351 95...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2391</td>
      <td>7738</td>
      <td>18511.806088</td>
      <td>1.405994e+07</td>
      <td>323</td>
      <td>937715</td>
      <td>953796</td>
      <td>3</td>
      <td>1123.0</td>
      <td>1123</td>
      <td>...</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>17396100.0</td>
      <td>0.8663</td>
      <td>0</td>
      <td>0</td>
      <td>23585.421941</td>
      <td>1.739613e+07</td>
      <td>POLYGON ((938072.285 952651.635, 937929.056 95...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6329</td>
      <td>11676</td>
      <td>10422.047410</td>
      <td>3.336191e+06</td>
      <td>77</td>
      <td>937781</td>
      <td>950989</td>
      <td>3</td>
      <td>1123.0</td>
      <td>1123</td>
      <td>...</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>17396100.0</td>
      <td>0.8663</td>
      <td>0</td>
      <td>0</td>
      <td>23585.421941</td>
      <td>1.739613e+07</td>
      <td>POLYGON ((938316.202 951630.563, 938211.071 95...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3052</td>
      <td>8399</td>
      <td>23965.014606</td>
      <td>3.096111e+07</td>
      <td>711</td>
      <td>934758</td>
      <td>961537</td>
      <td>664</td>
      <td>1105.0</td>
      <td>1105</td>
      <td>...</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>30961100.0</td>
      <td>0.8148</td>
      <td>0</td>
      <td>0</td>
      <td>23965.014606</td>
      <td>3.096111e+07</td>
      <td>POLYGON ((938616.375 961787.437, 938675.000 96...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 22 columns</p>
</div></div>
</div>
<p>Because we know that the MAZ’s are supposed to be nested within the TAZ’s, we would normally expect that the joined data would have exactly one row for each of the 361 MAZ’s, and that some TAZ’s would be duplicated. However, that’s not what has happened.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">maz_taz</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
564
</pre></div></div>
</div>
<div class="section" id="Managing-Errors-in-Joining-Spatial-Data">
<h3>Managing Errors in Joining Spatial Data<a class="headerlink" href="#Managing-Errors-in-Joining-Spatial-Data" title="Permalink to this headline">¶</a></h3>
<p>The joined data has 564 new zones, 203 more than we expected. There are two reasons for this discrepancy, although both are a result of the two zone systems being misaligned.</p>
<p>The first reason is related to the limits computer precision: some of the new zones are merely slivers of space that arise due to rounding errors on the computer placement of vertices. If we evaluate the area of the first 5 zones in the joined data table, we see that one of the zones is only 1.878×10-3 square feet, or about a quarter of a square inch. Clearly, this isn’t a real zone!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz_taz</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">area</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    4.442490e+06
1    1.878210e-03
2    1.405994e+07
3    3.336191e+06
4    3.096111e+07
dtype: float64
</pre></div></div>
</div>
<p>The seconds reason that extra zones are found in this join is because the two zone systems are not always carefully aligned by the analysts who originally drew the zones, particularly in areas that are not functionally important. For example, here are the boundaries for the TAZ and MAZ systems, superimposed over a map of the The Loxahatchee Club golf course in Jupiter.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">make_basemap</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">938500</span><span class="p">,</span><span class="mi">945500</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">937500</span><span class="p">,</span><span class="mi">944500</span><span class="p">),</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                             <span class="n">tiles</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">OpenStreetMap</span><span class="o">.</span><span class="n">Mapnik</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="mi">2236</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">taz_jupiter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">transparent</span> <span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">maz_jupiter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">transparent</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_78_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_78_0.png" />
</div>
</div>
<p>When the intersection of the two zone systems is computed, half a dozen extraneous small zones are generated along the lake that forms the western edge of the golf course, but these are not actually meaningful activity locations and are not relevant for transortation analysis.</p>
<p>The possible solutions to both problems are the same, given that we know that the “correct” join solution will have exactly one zone in the result for each MAZ.</p>
<div class="section" id="Dropping-Extra-Pieces">
<h4>Dropping Extra Pieces<a class="headerlink" href="#Dropping-Extra-Pieces" title="Permalink to this headline">¶</a></h4>
<p>One possible solution is to take the joined data we already have, and remove all the extra pieces of zones that were created, retaining only the largest main section of each MAZ. To do this, we can sort zones in the joined GeoDataFrame by area, and retain only the largest zone from each group of duplicated MAZ codes.</p>
<p>First, we’ll use the argsort method, to get the order of the joined zones, if ordered by area. Then we feed that into the <code class="docutils literal notranslate"><span class="pre">iloc</span></code> indexer to actually sort the rows as indicated. The argsort returns values in ascending order by default, so all the small slivers and bits of zones we want to discard will appear first.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz_taz</span> <span class="o">=</span> <span class="n">maz_taz</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">maz_taz</span><span class="o">.</span><span class="n">area</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<p>Then, we can drop duplicate MAZ values from the table, keeping only the last instance of each MAZ, which is the one we want. In theory, if the two zones systems are very poorly aligned, this process could drop the wrong part of the zones, although in almost all cases it will work fine.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz_taz</span> <span class="o">=</span> <span class="n">maz_taz</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s1">&#39;MAZ&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">maz_taz</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
361
</pre></div></div>
</div>
<div class="line-block">
<div class="line">One drawback of this method is that some small gaps may be left in the resulting joined GeoDataFrame zones, in the spaces that are removed, as illustrated below.</div>
<div class="line">This may or may not be problematic, depending on the application.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">make_basemap</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">938500</span><span class="p">,</span><span class="mi">945500</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">937500</span><span class="p">,</span><span class="mi">944500</span><span class="p">),</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                             <span class="n">tiles</span><span class="o">=</span><span class="n">tt</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">OpenStreetMap</span><span class="o">.</span><span class="n">Mapnik</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="mi">2236</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">maz_taz</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_87_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_87_0.png" />
</div>
</div>
</div>
<div class="section" id="Joining-on-Centroids">
<h4>Joining on Centroids<a class="headerlink" href="#Joining-on-Centroids" title="Permalink to this headline">¶</a></h4>
<p>An alternate solution is to join the TAZ and MAZ data in a entirely different manner. Rather than joining the two GeoDataFrames based on the area polygons in each, we can join based on the area polygons for TAZ’s and centroids for MAZ’s. To do this, we’ll use the <a class="reference external" href="http://geopandas.org/reference/geopandas.sjoin.html">sjoin</a> method.</p>
<p>First, we’ll need a version of the MAZ GeoDataFrame that has only centroid points in the <code class="docutils literal notranslate"><span class="pre">geometry</span></code> column, instead of polygons. To create this, start by making a copy of the original data (assuming we want to save it for later).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz_points</span> <span class="o">=</span> <span class="n">maz_jupiter</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz_points</span><span class="o">.</span><span class="n">geometry</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2388    POLYGON ((936374.674 959539.568, 936373.444 95...
2389    POLYGON ((942254.500 952920.937, 942255.812 95...
2390    POLYGON ((938309.917 952656.485, 938072.285 95...
2391    POLYGON ((953119.000 951985.375, 953045.807 95...
2392    POLYGON ((934328.283 951600.585, 934327.451 94...
                              ...
6343    POLYGON ((954175.937 952913.625, 954102.625 95...
6344    POLYGON ((950882.187 955225.125, 950885.630 95...
6345    POLYGON ((950885.630 954249.305, 950895.654 95...
6346    POLYGON ((952450.875 955006.750, 952471.625 95...
6674    POLYGON ((943433.201 943375.933, 943433.188 94...
Name: geometry, Length: 361, dtype: geometry
</pre></div></div>
</div>
<p>Then we want to change the geometry to be points instead of polygons. (Both <a class="reference external" href="https://shapely.readthedocs.io/en/stable/manual.html#points">Point</a> and <a class="reference external" href="https://shapely.readthedocs.io/en/stable/manual.html#polygons">Polygon</a> are specific object types in the shapely package that is used by GeoPandas.) We could simply use the ‘centroid’ attribute of the geometry column to find new centroid for each zone, but in this data we already have X and Y values for a centroid, so we’ll prefer to use
those. We can uses the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html">apply</a> method of DataFrames to create Point values, and assign those values into the geometry column.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="n">maz_points</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="o">.</span><span class="n">from_xy</span><span class="p">(</span><span class="n">maz_points</span><span class="o">.</span><span class="n">POINT_X</span><span class="p">,</span> <span class="n">maz_points</span><span class="o">.</span><span class="n">POINT_Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">Now we are ready to conduct a spatial join using the <a class="reference external" href="http://geopandas.org/reference/geopandas.sjoin.html">sjoin</a> function. Like the overlay function, this function accepts two GeoDataFrames and returns one, with general data columns from both inputs.</div>
<div class="line">Unlike the overlay function, the <a class="reference external" href="http://geopandas.org/reference/geopandas.sjoin.html">sjoin</a> does not create any new geometries; instead, the resulting GeoDataFrame contains geometry from either the left (first argument) or right (second argument) input GeoDataFrames.</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sjoined</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">maz_points</span><span class="p">,</span> <span class="n">taz_jupiter</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="s1">&#39;within&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">sjoined</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
361
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sjoined</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OBJECTID_left</th>
      <th>MAZ</th>
      <th>SHAPE_LENG</th>
      <th>SHAPE_AREA</th>
      <th>ACRES</th>
      <th>POINT_X</th>
      <th>POINT_Y</th>
      <th>geometry</th>
      <th>index_right</th>
      <th>OBJECTID_right</th>
      <th>...</th>
      <th>COUNTY</th>
      <th>CENSUSTAZ</th>
      <th>TAZ_BF</th>
      <th>FIX</th>
      <th>AREA</th>
      <th>F_NETAREA</th>
      <th>CBD</th>
      <th>HM_ROOMS</th>
      <th>Shape_Leng</th>
      <th>Shape_Area</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2388</th>
      <td>2389</td>
      <td>7736</td>
      <td>10592.846522</td>
      <td>4.442490e+06</td>
      <td>102</td>
      <td>936259</td>
      <td>957308</td>
      <td>POINT (936259.000 957308.000)</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>4442490.0</td>
      <td>0.8153</td>
      <td>0</td>
      <td>0</td>
      <td>10592.846522</td>
      <td>4.442490e+06</td>
    </tr>
    <tr>
      <th>2389</th>
      <td>2390</td>
      <td>7737</td>
      <td>17396.297932</td>
      <td>1.568938e+07</td>
      <td>360</td>
      <td>940102</td>
      <td>950911</td>
      <td>POINT (940102.000 950911.000)</td>
      <td>1</td>
      <td>2</td>
      <td>...</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>15689400.0</td>
      <td>0.8571</td>
      <td>0</td>
      <td>0</td>
      <td>17396.297932</td>
      <td>1.568938e+07</td>
    </tr>
    <tr>
      <th>2390</th>
      <td>2391</td>
      <td>7738</td>
      <td>18511.806088</td>
      <td>1.405994e+07</td>
      <td>323</td>
      <td>937715</td>
      <td>953796</td>
      <td>POINT (937715.000 953796.000)</td>
      <td>2</td>
      <td>3</td>
      <td>...</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>17396100.0</td>
      <td>0.8663</td>
      <td>0</td>
      <td>0</td>
      <td>23585.421941</td>
      <td>1.739613e+07</td>
    </tr>
    <tr>
      <th>2391</th>
      <td>2392</td>
      <td>7739</td>
      <td>7202.864864</td>
      <td>1.303422e+06</td>
      <td>30</td>
      <td>953218</td>
      <td>953704</td>
      <td>POINT (953218.000 953704.000)</td>
      <td>3</td>
      <td>4</td>
      <td>...</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>1303420.0</td>
      <td>0.8536</td>
      <td>0</td>
      <td>0</td>
      <td>7202.864864</td>
      <td>1.303422e+06</td>
    </tr>
    <tr>
      <th>2392</th>
      <td>2393</td>
      <td>7740</td>
      <td>24940.959492</td>
      <td>3.147748e+07</td>
      <td>723</td>
      <td>931973</td>
      <td>952018</td>
      <td>POINT (931973.000 952018.000)</td>
      <td>4</td>
      <td>5</td>
      <td>...</td>
      <td>1.0</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>31477500.0</td>
      <td>0.8787</td>
      <td>0</td>
      <td>0</td>
      <td>24940.959492</td>
      <td>3.147748e+07</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 23 columns</p>
</div></div>
</div>
<p>The resulting GeoDataFrame has the geometry from the left input, which in this case is just the centroid points.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">sjoined</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_98_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_98_0.png" />
</div>
</div>
<p>If we want to re-attach the polygon zones, we can do so easily if we didn’t overwrite the original MAZ data, because this joined data is in the same order as the original.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sjoined</span><span class="o">.</span><span class="n">MAZ</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">maz_jupiter</span><span class="o">.</span><span class="n">MAZ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sjoined</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">maz_jupiter</span><span class="o">.</span><span class="n">geometry</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">sjoined</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/course-content_geographic-analysis_working-with-geodata_102_0.png" src="../../_images/course-content_geographic-analysis_working-with-geodata_102_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Creating-a-Crosswalk-Dictionary-from-the-Joined-Data">
<h3>Creating a Crosswalk Dictionary from the Joined Data<a class="headerlink" href="#Creating-a-Crosswalk-Dictionary-from-the-Joined-Data" title="Permalink to this headline">¶</a></h3>
<p>We will sometimes be given a MAZ id but want to get the TAZ id instead. As this is a one-to-many mapping (every MAZ is in one and only one TAZ, but each TAZ can contain multiple MAZ’s), it is convenient to express this mapping as a Python dictionary. This can be done easily if the <code class="docutils literal notranslate"><span class="pre">index</span></code> of the GeoDataFrame is set to be the MAZ.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sjoined</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">sjoined</span><span class="o">.</span><span class="n">MAZ</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz_taz_crosswalk</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sjoined</span><span class="o">.</span><span class="n">TAZ_MPO</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz_taz_crosswalk</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{7736: 1122,
 7737: 17,
 7738: 1123,
 7739: 1120,
 7740: 1121,
 7741: 1150,
 7742: 1152,
 7743: 1140,
 7744: 44,
 7745: 1503,
 7746: 1547,
 7747: 1546,
 7748: 1103,
 7749: 1124,
 7750: 21,
 7751: 1504,
 7752: 842,
 7753: 1505,
 7754: 1506,
 7755: 1141,
 7756: 45,
 7757: 1153,
 7758: 1154,
 7759: 1155,
 7760: 59,
 7761: 1156,
 7762: 42,
 7763: 1507,
 7764: 844,
 7765: 1508,
 7766: 845,
 7767: 40,
 7768: 1138,
 7769: 38,
 7770: 1135,
 7771: 1137,
 7772: 887,
 7773: 1518,
 7774: 47,
 7775: 36,
 7776: 1134,
 7777: 1133,
 7778: 1125,
 7779: 27,
 7780: 1126,
 7781: 37,
 7782: 1136,
 7783: 1131,
 7784: 1130,
 7785: 34,
 7786: 1128,
 7787: 1129,
 7788: 1132,
 7791: 49,
 7792: 1143,
 7793: 890,
 7794: 1520,
 7795: 1519,
 7802: 1543,
 7803: 1544,
 7804: 1068,
 7805: 53,
 7806: 1127,
 7807: 1145,
 7808: 51,
 7809: 1146,
 7810: 1147,
 7811: 1148,
 7812: 1157,
 7813: 70,
 7814: 851,
 7815: 1510,
 7816: 1509,
 7817: 1161,
 7818: 88,
 7819: 89,
 7820: 1164,
 7821: 1163,
 7822: 90,
 7823: 1158,
 7824: 82,
 7825: 1159,
 7826: 1171,
 7827: 800,
 7828: 1477,
 7830: 1478,
 7831: 99,
 7832: 1522,
 7833: 893,
 7834: 1165,
 7835: 91,
 7836: 1167,
 7837: 1521,
 7838: 892,
 7839: 1168,
 7840: 1166,
 7841: 92,
 8209: 4,
 8210: 1151,
 8211: 56,
 8212: 58,
 8280: 32,
 8281: 1169,
 8282: 1160,
 8283: 1144,
 8284: 1149,
 8375: 798,
 8380: 95,
 8396: 1,
 8397: 2,
 8398: 1104,
 8399: 1105,
 8400: 1106,
 8401: 5,
 8402: 6,
 8403: 8,
 8404: 3,
 8405: 837,
 8406: 7,
 8407: 9,
 8408: 13,
 8412: 12,
 8413: 833,
 8414: 838,
 8415: 832,
 8416: 1067,
 8418: 14,
 8419: 19,
 8420: 18,
 8421: 840,
 8424: 831,
 8425: 792,
 8426: 834,
 8427: 20,
 8428: 22,
 8429: 55,
 8430: 841,
 8431: 835,
 8432: 885,
 8433: 43,
 8434: 843,
 8435: 57,
 8436: 886,
 8437: 836,
 8438: 60,
 8439: 23,
 8440: 46,
 8442: 39,
 8443: 61,
 8444: 62,
 8445: 26,
 8448: 793,
 8449: 795,
 8450: 64,
 8451: 796,
 8452: 63,
 8453: 891,
 8454: 29,
 8455: 28,
 8456: 48,
 8457: 797,
 8458: 847,
 8459: 794,
 8460: 65,
 8462: 68,
 8463: 848,
 8464: 853,
 8465: 849,
 8466: 850,
 8467: 888,
 8468: 30,
 8469: 69,
 8470: 50,
 8471: 80,
 8472: 71,
 8473: 33,
 8475: 52,
 8476: 81,
 8477: 72,
 8478: 31,
 8479: 799,
 8480: 825,
 8482: 852,
 8483: 75,
 8484: 83,
 8485: 74,
 8486: 101,
 8487: 98,
 8488: 93,
 8489: 84,
 8491: 103,
 8492: 102,
 9190: 73,
 9197: 11,
 9198: 10,
 9199: 54,
 9200: 889,
 9201: 35,
 9202: 67,
 9203: 66,
 9204: 87,
 9226: 846,
 9232: 16,
 9233: 1139,
 9234: 1142,
 9235: 100,
 9236: 1162,
 9366: 15,
 9367: 1523,
 9370: 1170,
 9371: 839,
 9372: 1588,
 9373: 24,
 9374: 1567,
 9375: 1570,
 9376: 1571,
 9377: 41,
 9378: 25,
 9379: 1569,
 9380: 1568,
 10459: 87,
 10460: 93,
 10461: 892,
 10462: 93,
 10464: 93,
 10466: 92,
 10467: 102,
 10469: 101,
 10470: 101,
 10471: 1161,
 10472: 1162,
 10473: 82,
 10474: 81,
 10475: 81,
 10476: 72,
 10477: 73,
 10478: 1160,
 10479: 83,
 10480: 83,
 10481: 83,
 10482: 84,
 10483: 84,
 10484: 84,
 10485: 95,
 11579: 1068,
 11580: 1068,
 11581: 850,
 11582: 889,
 11583: 889,
 11584: 1145,
 11585: 1146,
 11586: 1147,
 11587: 50,
 11588: 50,
 11589: 80,
 11590: 80,
 11591: 80,
 11592: 70,
 11593: 67,
 11594: 67,
 11595: 67,
 11596: 67,
 11597: 66,
 11598: 66,
 11599: 66,
 11600: 66,
 11601: 65,
 11602: 65,
 11603: 65,
 11604: 65,
 11605: 65,
 11606: 49,
 11607: 890,
 11608: 35,
 11609: 27,
 11610: 1126,
 11611: 1126,
 11612: 1133,
 11613: 1136,
 11614: 1136,
 11615: 25,
 11616: 25,
 11617: 25,
 11618: 1569,
 11619: 38,
 11620: 39,
 11621: 39,
 11622: 64,
 11623: 64,
 11624: 64,
 11625: 891,
 11626: 891,
 11627: 63,
 11628: 61,
 11629: 886,
 11630: 885,
 11631: 1504,
 11632: 843,
 11633: 843,
 11634: 24,
 11635: 24,
 11636: 1567,
 11637: 24,
 11638: 1570,
 11639: 40,
 11640: 40,
 11641: 43,
 11642: 43,
 11643: 42,
 11644: 1139,
 11645: 844,
 11646: 844,
 11647: 45,
 11648: 60,
 11649: 60,
 11650: 60,
 11651: 60,
 11652: 60,
 11653: 60,
 11654: 1155,
 11655: 1155,
 11656: 59,
 11657: 1155,
 11658: 1154,
 11659: 1150,
 11660: 56,
 11661: 54,
 11662: 44,
 11663: 20,
 11664: 20,
 11665: 20,
 11666: 21,
 11667: 21,
 11668: 21,
 11669: 21,
 11670: 21,
 11671: 1124,
 11672: 1124,
 11673: 1124,
 11674: 22,
 11675: 22,
 11676: 1123,
 11677: 3,
 11678: 5,
 11679: 5,
 11680: 5,
 11681: 5,
 11682: 6,
 11683: 6,
 11684: 7,
 11685: 7,
 11686: 7,
 11687: 7,
 11688: 8,
 11689: 8,
 11690: 10,
 11691: 13,
 11692: 4,
 11693: 4,
 11694: 4,
 12022: 843}
</pre></div></div>
</div>
<p>Then, given a MAZ number we can access the TAZ simply like this:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maz_number</span> <span class="o">=</span> <span class="mi">7755</span>
<span class="n">taz_number</span> <span class="o">=</span> <span class="n">maz_taz_crosswalk</span><span class="p">[</span><span class="n">maz_number</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="accessing-openstreetmap.html" class="btn btn-neutral float-right" title="Accessing OpenStreetMap Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="_index.html" class="btn btn-neutral float-left" title="Geographic Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>