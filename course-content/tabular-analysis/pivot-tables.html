

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Crosstab and Pivot Tables &mdash; Python for Transportation 1.0.1, March 2020 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Linear Regression" href="linear-regression.html" />
    <link rel="prev" title="Basic Data Analysis with Pandas" href="basic-analysis-with-pandas.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Python for Transportation
          

          
          </a>

          
            
            
              <div class="version">
                1.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../starting/_index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic-python/_index.html">Python Fundamentals</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_index.html">Tabular Data Analysis</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic-analysis-with-pandas.html">Basic Data Analysis with Pandas</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Crosstab and Pivot Tables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Simple-Pivot-Tables">Simple Pivot Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Marginals">Marginals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Aggregation-Functions">Aggregation Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Using-Binning-of-Continuous-Variables">Using Binning of Continuous Variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="linear-regression.html">Linear Regression</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/_index.html">Data Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geographic-analysis/_index.html">Geographic Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../choice-modeling/_index.html">Discrete Choice Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/_index.html">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/example-data.html">Tutorial Data Files</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python for Transportation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="_index.html">Tabular Data Analysis</a> &raquo;</li>
        
      <li>Crosstab and Pivot Tables</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/course-content/tabular-analysis/pivot-tables.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">transportation_tutorials</span> <span class="k">as</span> <span class="nn">tt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
<div class="section" id="Crosstab-and-Pivot-Tables">
<h1>Crosstab and Pivot Tables<a class="headerlink" href="#Crosstab-and-Pivot-Tables" title="Permalink to this headline">¶</a></h1>
<p>If you are familiar with the “pivot table” functionality in spreadsheets, you’ll find pretty much the same functionality in pandas using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pivot_table.html#pandas.DataFrame.pivot_table">pivot_table</a>.</p>
<p>To demonstrate some features of pivot tables with pandas, we’ll load and populate the households data from the Jupiter study area:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;SERPM8-BASE2015-HOUSEHOLDS&#39;</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hh</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;hh_id&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Count of persons per HH</span>
<span class="n">persons</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;SERPM8-BASE2015-PERSONS&#39;</span><span class="p">))</span>
<span class="n">hh</span> <span class="o">=</span> <span class="n">hh</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">persons</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hh_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;hhsize&#39;</span><span class="p">),</span>
    <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hh_id&#39;</span><span class="p">],</span>
    <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Count of trips per HH</span>
<span class="n">trips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;SERPM8-BASE2015-TRIPS&#39;</span><span class="p">))</span>
<span class="n">hh</span> <span class="o">=</span> <span class="n">hh</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">trips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;hh_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;n_trips&#39;</span><span class="p">),</span>
    <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hh_id&#39;</span><span class="p">],</span>
    <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Simple-Pivot-Tables">
<h2>Simple Pivot Tables<a class="headerlink" href="#Simple-Pivot-Tables" title="Permalink to this headline">¶</a></h2>
<p>To generate a pivot table, we will use the <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code> method of the households DataFrame. This method takes three principal arguments: <code class="docutils literal notranslate"><span class="pre">index</span></code>, <code class="docutils literal notranslate"><span class="pre">columns</span></code>, and <code class="docutils literal notranslate"><span class="pre">values</span></code>. The <code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">columns</span></code> indicate the aggregation categories for the rows and columns of the resulting summary table, respectively. The <code class="docutils literal notranslate"><span class="pre">values</span></code> indicate which column of values should be aggregated.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hh</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;hhsize&#39;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;autos&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="s1">&#39;n_trips&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>autos</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
    <tr>
      <th>hhsize</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>3.000000</td>
      <td>3.825093</td>
      <td>3.390000</td>
      <td>3.142857</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5.122137</td>
      <td>6.108434</td>
      <td>6.641809</td>
      <td>6.690341</td>
      <td>6.538462</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7.200000</td>
      <td>8.551613</td>
      <td>9.376471</td>
      <td>9.581549</td>
      <td>9.172043</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10.750000</td>
      <td>10.922330</td>
      <td>11.739943</td>
      <td>12.326733</td>
      <td>11.936364</td>
    </tr>
    <tr>
      <th>5</th>
      <td>13.230769</td>
      <td>12.893617</td>
      <td>13.583893</td>
      <td>14.485714</td>
      <td>13.821782</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7.500000</td>
      <td>12.868421</td>
      <td>15.778351</td>
      <td>15.783784</td>
      <td>17.593407</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>20.500000</td>
      <td>19.733333</td>
      <td>18.725000</td>
      <td>20.117647</td>
    </tr>
    <tr>
      <th>8</th>
      <td>11.000000</td>
      <td>13.600000</td>
      <td>16.791667</td>
      <td>16.428571</td>
      <td>20.200000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>22.631579</td>
      <td>21.863636</td>
      <td>19.687500</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>18.000000</td>
      <td>34.000000</td>
      <td>18.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>If you only want to evalate the pivot table on one dimension, you can omit either <code class="docutils literal notranslate"><span class="pre">index</span></code> or <code class="docutils literal notranslate"><span class="pre">columns</span></code>, which gives the results you might expect:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hh</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;autos&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="s1">&#39;n_trips&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>autos</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>n_trips</th>
      <td>4.600985</td>
      <td>4.813088</td>
      <td>8.114862</td>
      <td>10.090541</td>
      <td>13.364162</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hh</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;hhsize&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="s1">&#39;n_trips&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n_trips</th>
    </tr>
    <tr>
      <th>hhsize</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>3.770963</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6.516076</td>
    </tr>
    <tr>
      <th>3</th>
      <td>9.286667</td>
    </tr>
    <tr>
      <th>4</th>
      <td>11.827869</td>
    </tr>
    <tr>
      <th>5</th>
      <td>13.812303</td>
    </tr>
    <tr>
      <th>6</th>
      <td>15.790909</td>
    </tr>
    <tr>
      <th>7</th>
      <td>19.536585</td>
    </tr>
    <tr>
      <th>8</th>
      <td>15.851852</td>
    </tr>
    <tr>
      <th>9</th>
      <td>21.109589</td>
    </tr>
    <tr>
      <th>10</th>
      <td>23.333333</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Marginals">
<h2>Marginals<a class="headerlink" href="#Marginals" title="Permalink to this headline">¶</a></h2>
<p>The two outputs above are actually the marginals of the original pivot table. If you want to generate the entire pivot table and include the marginals on rows and columns, you can do that in one step with the <code class="docutils literal notranslate"><span class="pre">margins</span></code> argument:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hh</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;hhsize&#39;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;autos&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="s1">&#39;n_trips&#39;</span><span class="p">,</span>
    <span class="n">margins</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>autos</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>All</th>
    </tr>
    <tr>
      <th>hhsize</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>3.000000</td>
      <td>3.825093</td>
      <td>3.390000</td>
      <td>3.142857</td>
      <td>NaN</td>
      <td>3.770963</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5.122137</td>
      <td>6.108434</td>
      <td>6.641809</td>
      <td>6.690341</td>
      <td>6.538462</td>
      <td>6.516076</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7.200000</td>
      <td>8.551613</td>
      <td>9.376471</td>
      <td>9.581549</td>
      <td>9.172043</td>
      <td>9.286667</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10.750000</td>
      <td>10.922330</td>
      <td>11.739943</td>
      <td>12.326733</td>
      <td>11.936364</td>
      <td>11.827869</td>
    </tr>
    <tr>
      <th>5</th>
      <td>13.230769</td>
      <td>12.893617</td>
      <td>13.583893</td>
      <td>14.485714</td>
      <td>13.821782</td>
      <td>13.812303</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7.500000</td>
      <td>12.868421</td>
      <td>15.778351</td>
      <td>15.783784</td>
      <td>17.593407</td>
      <td>15.790909</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>20.500000</td>
      <td>19.733333</td>
      <td>18.725000</td>
      <td>20.117647</td>
      <td>19.536585</td>
    </tr>
    <tr>
      <th>8</th>
      <td>11.000000</td>
      <td>13.600000</td>
      <td>16.791667</td>
      <td>16.428571</td>
      <td>20.200000</td>
      <td>15.851852</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>22.631579</td>
      <td>21.863636</td>
      <td>19.687500</td>
      <td>21.109589</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>18.000000</td>
      <td>34.000000</td>
      <td>18.000000</td>
      <td>23.333333</td>
    </tr>
    <tr>
      <th>All</th>
      <td>4.600985</td>
      <td>4.813088</td>
      <td>8.114862</td>
      <td>10.090541</td>
      <td>13.364162</td>
      <td>7.176941</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Aggregation-Functions">
<h2>Aggregation Functions<a class="headerlink" href="#Aggregation-Functions" title="Permalink to this headline">¶</a></h2>
<p>By default, <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code> computes the mean (average) for the <code class="docutils literal notranslate"><span class="pre">values</span></code> column aggregated within the categories that define each cell. However, alternate aggregation functions can be used, such as <code class="docutils literal notranslate"><span class="pre">'count'</span></code>, <code class="docutils literal notranslate"><span class="pre">'std'</span></code> (the standard deviation), or <code class="docutils literal notranslate"><span class="pre">'sem'</span></code> (the standard error of the mean). One or more functions can be specified using the <code class="docutils literal notranslate"><span class="pre">aggfunc</span></code> argument:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hh</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;hhsize&#39;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;autos&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="s1">&#39;n_trips&#39;</span><span class="p">,</span>
    <span class="n">aggfunc</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;sem&#39;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="5" halign="left">mean</th>
      <th colspan="5" halign="left">count</th>
      <th colspan="5" halign="left">sem</th>
    </tr>
    <tr>
      <th>autos</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
    <tr>
      <th>hhsize</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>3.000000</td>
      <td>3.825093</td>
      <td>3.390000</td>
      <td>3.142857</td>
      <td>NaN</td>
      <td>215.0</td>
      <td>4551.0</td>
      <td>200.0</td>
      <td>7.0</td>
      <td>NaN</td>
      <td>0.114196</td>
      <td>0.029032</td>
      <td>0.117081</td>
      <td>0.704698</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5.122137</td>
      <td>6.108434</td>
      <td>6.641809</td>
      <td>6.690341</td>
      <td>6.538462</td>
      <td>131.0</td>
      <td>1411.0</td>
      <td>5042.0</td>
      <td>704.0</td>
      <td>52.0</td>
      <td>0.206478</td>
      <td>0.068357</td>
      <td>0.039829</td>
      <td>0.108316</td>
      <td>0.362725</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7.200000</td>
      <td>8.551613</td>
      <td>9.376471</td>
      <td>9.581549</td>
      <td>9.172043</td>
      <td>30.0</td>
      <td>310.0</td>
      <td>1360.0</td>
      <td>607.0</td>
      <td>93.0</td>
      <td>0.523911</td>
      <td>0.177461</td>
      <td>0.084386</td>
      <td>0.140620</td>
      <td>0.375009</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10.750000</td>
      <td>10.922330</td>
      <td>11.739943</td>
      <td>12.326733</td>
      <td>11.936364</td>
      <td>8.0</td>
      <td>103.0</td>
      <td>696.0</td>
      <td>303.0</td>
      <td>110.0</td>
      <td>2.024405</td>
      <td>0.375504</td>
      <td>0.134725</td>
      <td>0.229000</td>
      <td>0.396456</td>
    </tr>
    <tr>
      <th>5</th>
      <td>13.230769</td>
      <td>12.893617</td>
      <td>13.583893</td>
      <td>14.485714</td>
      <td>13.821782</td>
      <td>13.0</td>
      <td>47.0</td>
      <td>298.0</td>
      <td>175.0</td>
      <td>101.0</td>
      <td>1.387461</td>
      <td>0.545975</td>
      <td>0.243191</td>
      <td>0.327388</td>
      <td>0.444192</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7.500000</td>
      <td>12.868421</td>
      <td>15.778351</td>
      <td>15.783784</td>
      <td>17.593407</td>
      <td>6.0</td>
      <td>38.0</td>
      <td>194.0</td>
      <td>111.0</td>
      <td>91.0</td>
      <td>1.962142</td>
      <td>0.801111</td>
      <td>0.390703</td>
      <td>0.544559</td>
      <td>0.552932</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>20.500000</td>
      <td>19.733333</td>
      <td>18.725000</td>
      <td>20.117647</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>45.0</td>
      <td>40.0</td>
      <td>34.0</td>
      <td>NaN</td>
      <td>1.658312</td>
      <td>0.819214</td>
      <td>0.807011</td>
      <td>0.840979</td>
    </tr>
    <tr>
      <th>8</th>
      <td>11.000000</td>
      <td>13.600000</td>
      <td>16.791667</td>
      <td>16.428571</td>
      <td>20.200000</td>
      <td>3.0</td>
      <td>15.0</td>
      <td>24.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>3.605551</td>
      <td>1.463199</td>
      <td>1.367293</td>
      <td>1.836886</td>
      <td>2.457641</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>22.631579</td>
      <td>21.863636</td>
      <td>19.687500</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>19.0</td>
      <td>22.0</td>
      <td>32.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.035088</td>
      <td>1.211945</td>
      <td>0.988276</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>18.000000</td>
      <td>34.000000</td>
      <td>18.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>If all you want is to simply count the number of rows in each category, you can use <code class="docutils literal notranslate"><span class="pre">aggfunc='size'</span></code>, which will do so without requiring a <code class="docutils literal notranslate"><span class="pre">values</span></code> argument.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hh</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;hhsize&#39;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;autos&#39;</span><span class="p">,</span>
    <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;size&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>autos</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
    <tr>
      <th>hhsize</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>215.0</td>
      <td>4551.0</td>
      <td>200.0</td>
      <td>7.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>131.0</td>
      <td>1411.0</td>
      <td>5042.0</td>
      <td>704.0</td>
      <td>52.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30.0</td>
      <td>310.0</td>
      <td>1360.0</td>
      <td>607.0</td>
      <td>93.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8.0</td>
      <td>103.0</td>
      <td>696.0</td>
      <td>303.0</td>
      <td>110.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>13.0</td>
      <td>47.0</td>
      <td>298.0</td>
      <td>175.0</td>
      <td>101.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6.0</td>
      <td>38.0</td>
      <td>194.0</td>
      <td>111.0</td>
      <td>91.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>4.0</td>
      <td>45.0</td>
      <td>40.0</td>
      <td>34.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>3.0</td>
      <td>15.0</td>
      <td>24.0</td>
      <td>7.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>19.0</td>
      <td>22.0</td>
      <td>32.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>You can observe that the empty cells in the result above do not show zero, but rather <code class="docutils literal notranslate"><span class="pre">NaN</span></code> – and this results in the data type for the content being <code class="docutils literal notranslate"><span class="pre">float</span></code> instead of <code class="docutils literal notranslate"><span class="pre">int</span></code>, as there is no <code class="docutils literal notranslate"><span class="pre">NaN</span></code> representation in integers. To correct this, set the <code class="docutils literal notranslate"><span class="pre">fill_value</span></code> to zero as well:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hh</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;hhsize&#39;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;autos&#39;</span><span class="p">,</span>
    <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;size&#39;</span><span class="p">,</span>
    <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>autos</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
    <tr>
      <th>hhsize</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>215</td>
      <td>4551</td>
      <td>200</td>
      <td>7</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>131</td>
      <td>1411</td>
      <td>5042</td>
      <td>704</td>
      <td>52</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>310</td>
      <td>1360</td>
      <td>607</td>
      <td>93</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8</td>
      <td>103</td>
      <td>696</td>
      <td>303</td>
      <td>110</td>
    </tr>
    <tr>
      <th>5</th>
      <td>13</td>
      <td>47</td>
      <td>298</td>
      <td>175</td>
      <td>101</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>38</td>
      <td>194</td>
      <td>111</td>
      <td>91</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>4</td>
      <td>45</td>
      <td>40</td>
      <td>34</td>
    </tr>
    <tr>
      <th>8</th>
      <td>3</td>
      <td>15</td>
      <td>24</td>
      <td>7</td>
      <td>5</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0</td>
      <td>0</td>
      <td>19</td>
      <td>22</td>
      <td>32</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Using-Binning-of-Continuous-Variables">
<h2>Using Binning of Continuous Variables<a class="headerlink" href="#Using-Binning-of-Continuous-Variables" title="Permalink to this headline">¶</a></h2>
<p>As with the <code class="docutils literal notranslate"><span class="pre">groupby</span></code> function, using a non-categorical column for aggregation can be problematic, or may result in a pivot table larger than desired. For example, if we switch ‘hhsize’ for ‘income’ on this dataset, the pivot table will have over 2,000 rows.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hh</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;income&#39;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;autos&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="s1">&#39;n_trips&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>autos</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
    <tr>
      <th>income</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-9499</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.333333</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>-2400</th>
      <td>2.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>-2000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>12.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>0</th>
      <td>3.641026</td>
      <td>4.524064</td>
      <td>4.956522</td>
      <td>2.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>4.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>100</th>
      <td>NaN</td>
      <td>3.500000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>200</th>
      <td>NaN</td>
      <td>5.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>220</th>
      <td>NaN</td>
      <td>7.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>230</th>
      <td>NaN</td>
      <td>4.500000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>400</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>10.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>480</th>
      <td>3.000000</td>
      <td>2.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>500</th>
      <td>NaN</td>
      <td>5.250000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>600</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>650</th>
      <td>NaN</td>
      <td>2.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>690</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>12.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>800</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>900</th>
      <td>NaN</td>
      <td>8.500000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>950</th>
      <td>NaN</td>
      <td>4.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1000</th>
      <td>NaN</td>
      <td>3.500000</td>
      <td>8.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1100</th>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1300</th>
      <td>4.666667</td>
      <td>3.812500</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1400</th>
      <td>3.000000</td>
      <td>5.333333</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1500</th>
      <td>NaN</td>
      <td>3.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1600</th>
      <td>NaN</td>
      <td>3.000000</td>
      <td>9.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1700</th>
      <td>NaN</td>
      <td>3.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1800</th>
      <td>2.000000</td>
      <td>5.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>NaN</td>
      <td>3.000000</td>
      <td>2.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2100</th>
      <td>NaN</td>
      <td>4.000000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2200</th>
      <td>NaN</td>
      <td>2.500000</td>
      <td>2.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2400</th>
      <td>NaN</td>
      <td>2.500000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>646300</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>10.000000</td>
      <td>14.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>646700</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.666667</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>647000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.500000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>664000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.000000</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>667000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>13.333333</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>668000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.750000</td>
      <td>6.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>671260</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>9.000000</td>
      <td>NaN</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>680000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>697000</th>
      <td>NaN</td>
      <td>12.000000</td>
      <td>9.000000</td>
      <td>14.250000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>701100</th>
      <td>NaN</td>
      <td>4.000000</td>
      <td>8.500000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>704000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>9.500000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>707000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>12.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>720600</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>729000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>746000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>12.500000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>755000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>20.666667</td>
      <td>25.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>782000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>17.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>793000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>9.500000</td>
      <td>8.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>798000</th>
      <td>NaN</td>
      <td>4.800000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>805000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>807600</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.500000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>812000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.600000</td>
      <td>9.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>846000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>857000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>907000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>11.000000</td>
      <td>9.666667</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>916000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>13.500000</td>
      <td>19.800000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>922500</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>14.000000</td>
      <td>7.500000</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>975000</th>
      <td>NaN</td>
      <td>12.500000</td>
      <td>NaN</td>
      <td>14.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>985000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>10.333333</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1040000</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.000000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>2048 rows × 5 columns</p>
</div></div>
</div>
<p>This problem can be addressed by reformatting the relevant variable into a categorical form, using a binning function. For pivot tables, the <code class="docutils literal notranslate"><span class="pre">pandas.qcut</span></code> function is often a good choice for this, as it will bin the variable so that each bin has a similar total number of observations from the source table.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hh</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">hh</span><span class="o">.</span><span class="n">income</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;autos&#39;</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="s1">&#39;n_trips&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>autos</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
    <tr>
      <th>income</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(-9499.001, 31600.0]</th>
      <td>4.325806</td>
      <td>4.516639</td>
      <td>7.717423</td>
      <td>9.283019</td>
      <td>13.230769</td>
    </tr>
    <tr>
      <th>(31600.0, 57000.0]</th>
      <td>4.807018</td>
      <td>4.940185</td>
      <td>7.586078</td>
      <td>9.391061</td>
      <td>12.796296</td>
    </tr>
    <tr>
      <th>(57000.0, 91000.0]</th>
      <td>7.416667</td>
      <td>4.740959</td>
      <td>7.990544</td>
      <td>9.912644</td>
      <td>14.240741</td>
    </tr>
    <tr>
      <th>(91000.0, 145800.0]</th>
      <td>4.444444</td>
      <td>5.722326</td>
      <td>8.471237</td>
      <td>9.681750</td>
      <td>12.485915</td>
    </tr>
    <tr>
      <th>(145800.0, 1040000.0]</th>
      <td>5.833333</td>
      <td>4.968872</td>
      <td>8.328530</td>
      <td>10.888717</td>
      <td>13.673267</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>As you might notice above, the <code class="docutils literal notranslate"><span class="pre">index</span></code> argument (and also the <code class="docutils literal notranslate"><span class="pre">columns</span></code>) does not need to be the name of a column in the original DataFrame, but instead can be an indexed-alike Series or similar object than can be used to define the group-by categories for that axis of the resulting pivot.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="linear-regression.html" class="btn btn-neutral float-right" title="Linear Regression" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="basic-analysis-with-pandas.html" class="btn btn-neutral float-left" title="Basic Data Analysis with Pandas" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>